import{i as I,r as t,aD as _,aE as U,y as o,j as e,B as P,ab as G,ad as H,aF as R,aG as $}from"./index-DnLSs86n.js";import{L as K}from"./Layout-BqLwj7i-.js";import{T as Q}from"./TabelContainer-0T-vlQNa.js";import{r as J,u as V}from"./xlsx-R0LD_mVJ.js";import"./Menus-C_0QUNbK.js";import"./index-DESm-F1K.js";const q=()=>{const i=I(),d=i.gradeId,h=i.code,[b,x]=t.useState(null),[c,g]=t.useState(""),[p,{data:j,isSuccess:m,isLoading:E,error:u,reset:r}]=_(),[w,{data:f,isSuccess:N,error:l,isLoading:F}]=U(),C=s=>{x(s.target.files[0])},S=()=>{if(b){const s=new FileReader;s.onload=k=>{const D=new Uint8Array(k.target.result),v=J(D,{type:"array"}),a=v.SheetNames[0],T=v.Sheets[a],A={data:V.sheet_to_json(T,{header:1,range:1}).filter(M=>M.length>0)};w({gradeId:d,code:h,body:A})},s.readAsArrayBuffer(b)}},y=s=>{s.preventDefault(),p({nis:c,gradeId:d,code:h})},L=()=>{window.open("/temp/siswa_kelas_template.xlsx","_blank")};return t.useEffect(()=>{N&&(o.success(f.message),x(null)),l&&o.error(l.data.message)},[N,f,l]),t.useEffect(()=>{m&&(o.success(j.message),r(),g("")),u&&(o.error(u.data.message),r())},[j,m,u]),e.jsxs("div",{className:"d-flex flex-column gap-2 rounded shadow p-2 mt-2",children:[e.jsx("p",{className:"m-0 h5",children:"Tambahkan Siswa"}),e.jsxs("form",{action:"",className:"d-flex flex-column gap-2",onSubmit:y,children:[e.jsx("input",{type:"text",name:"nis",id:"",placeholder:"Masukan NIS",className:"form-control",value:c||"",onChange:s=>g(s.target.value)}),e.jsx("button",{type:"submit",className:"btn btn-success",children:"+ Tambahkan"}),e.jsx("button",{type:"button",className:"btn btn-info","data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",children:"Unggah Berkas"})]}),e.jsx("div",{className:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"staticBackdropLabel",children:"Pilih Berkas"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body d-flex flex-column align-items-end gap-2",children:e.jsx("input",{type:"file",name:"file",id:"",className:"form-control",onChange:C})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-warning",onClick:L,children:"Template"}),e.jsx("button",{type:"button",className:"btn btn-danger","data-bs-dismiss":"modal",children:"Tutup"}),F?e.jsx(P,{}):e.jsx("button",{type:"button",className:"btn btn-primary",onClick:S,children:"Unggah"})]})]})})})]})},z=[{label:"No"},{label:"NIS"},{label:"Nama"},{label:"Tingkat"},{label:"Kelas"},{label:"Database"},{label:"Aksi"}],ae=()=>{const i=I(),d=i.code,h=i.name,b="",x="",[c,g]=t.useState(1),[p,j]=t.useState(10),[m,E]=t.useState(""),{data:u={}}=G({homebase:b,gradeId:x,classCode:d,page:c,limit:p,search:m}),{students:r=[],totalPages:w,totalStudents:f}=u,{data:N={}}=H({page:c,limit:p,search:m,classCode:d}),{database:l=[],totalPages:F}=N,[C,{data:S,isSuccess:y,isLoading:L,error:s}]=R(),[k]=$(),D=a=>{C(a)},v=()=>k(d);return t.useEffect(()=>{y&&o.success(S.message),s&&o.error(s.data.message)},[S,y,s]),e.jsx(K,{title:`Kelas ${h}`,children:e.jsxs("div",{className:"row",style:{height:"100%"},children:[e.jsx("div",{className:"col-lg-3 col-12",children:e.jsx(q,{})}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsxs(Q,{page:c,setPage:a=>g(a),setLimit:a=>j(a),onValue:a=>E(a),totalPages:w,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("p",{className:"h6 m-0",children:["Jumlah Siswa: ",e.jsx("span",{children:f})]}),e.jsx("button",{className:"btn btn-danger",onClick:v,children:"Hapus Semua"})]}),e.jsxs("table",{className:"table table-striped table-hover mt-2",children:[e.jsx("thead",{children:e.jsx("tr",{children:z.map(a=>e.jsx("th",{scope:"col",className:"text-center",children:a.label},a.label))})}),e.jsx("tbody",{children:r==null?void 0:r.map((a,T)=>{var B;const n=(B=l==null?void 0:l.find(A=>A.nis===a.nis))==null?void 0:B.kelengkapan;return e.jsxs("tr",{children:[e.jsx("th",{scope:"row",className:"text-center align-middle",children:T+1}),e.jsx("td",{className:"text-center align-middle",children:a.nis}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"text-center align-middle",children:a.grade}),e.jsx("td",{className:"text-center align-middle",children:a.class}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("div",{className:"progress",style:{width:"100%"},children:e.jsx("div",{className:"progress-bar shadow",role:"progressbar",style:{width:`${n||0}%`},"aria-valuenow":n||0,"aria-valuemin":"0","aria-valuemax":100,children:`${n||0}%`})})}),e.jsx("td",{children:L?e.jsx(P,{}):e.jsx("div",{className:"d-flex justify-content-center gap-2",children:e.jsx("button",{className:"btn btn-danger",onClick:()=>D(a.id),children:"Hapus"})})})]},a.id)})})]})]})})]})})};export{ae as default};
