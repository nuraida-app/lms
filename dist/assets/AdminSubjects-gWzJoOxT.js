import{r as t,aD as H,aE as K,y as o,j as e,B as A,e as R,aF as U,K as G,aG as $,aH as q}from"./index-DMvCZNdX.js";import{L as I}from"./Layout-CToqIS0h.js";import{r as Q,u as V}from"./xlsx-R0LD_mVJ.js";import{T as z}from"./TabelContainer-Df-0NVOq.js";import"./Menus-C_0QUNbK.js";import"./index-mJC8lMn1.js";const J=({detail:n,id:c})=>{const[x,d]=t.useState(""),[b,p]=t.useState(""),[f,i]=t.useState(null),[C,{data:N,isSuccess:m,isLoading:T,error:k,reset:u}]=H(),[D,{data:S,isSuccess:y,isLoading:L,error:h,reset:E}]=K(),j=s=>{if(s.preventDefault(),!x||!b)return o.error("Pastikan form diisi");C({id:c,code:x,subject:b})},v=()=>{window.open("/temp/mapel_template.xlsx","_blank")},B=s=>{i(s.target.files[0])},M=()=>{if(f){const s=new FileReader;s.onload=w=>{const a=new Uint8Array(w.target.result),r=Q(a,{type:"array"}),l=r.SheetNames[0],g=r.Sheets[l],_={data:V.sheet_to_json(g,{header:1,range:1}).filter(F=>F.length>0)};D(_)},s.readAsArrayBuffer(f)}};return t.useEffect(()=>{m&&(o.success(N.message),d(""),p(""),u()),k&&(o.error(k.data.message),u())},[m,k,N,u]),t.useEffect(()=>{y&&(o.success(S.message),u(),i(null)),h&&(o.error(h.data.message),E())},[S,y,h]),t.useEffect(()=>{n&&(d((n==null?void 0:n.code)||""),p((n==null?void 0:n.name)||""))},[n]),t.useEffect(()=>{m&&c&&window.location.reload()},[m,c]),e.jsxs("div",{className:"d-flex flex-column gap-2 mt-2 rounded shadow p-2 bg-white border border-2",children:[e.jsx("p",{className:"m-0 h5",children:"Tambahkan Mata Pelajaran"}),e.jsxs("form",{action:"",className:"d-flex flex-column gap-2",onSubmit:j,children:[e.jsx("input",{type:"text",name:"code",placeholder:"Kode Mata Pelajaran",className:"form-control",required:!0,value:x,onChange:s=>d(s.target.value)}),e.jsx("input",{type:"text",name:"name",placeholder:"Nama Mata Pelajaran",className:"form-control",required:!0,value:b,onChange:s=>p(s.target.value)}),T?e.jsx(A,{}):e.jsx("button",{type:"submit",className:"btn btn-success",children:"+ Tambahkan"}),e.jsx("button",{type:"button",className:"btn btn-info","data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",children:"Unggah Berkas"})]}),e.jsx("div",{className:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"staticBackdropLabel",children:"Pilih Berkas"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body d-flex flex-column align-items-end gap-2",children:e.jsx("input",{type:"file",name:"file",className:"form-control",onChange:B})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-warning",onClick:v,children:"Template"}),e.jsx("button",{type:"button",className:"btn btn-danger","data-bs-dismiss":"modal",children:"Tutup"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:M,children:"Unggah"})]})]})})})]})},P=[{label:"No"},{label:"Kode"},{label:"Satuan"},{label:"Nama"},{label:"Detail"},{label:"Aksi"}],te=()=>{const n=R(),[c,x]=t.useState(1),[d,b]=t.useState(10),[p,f]=t.useState(""),[i,C]=t.useState(""),{data:N}=U(i,{skip:!i}),{data:m={},isLoading:T,error:k}=G({page:c,limit:d,search:p}),{subjects:u=[],totalPages:D,total:S}=m,[y,{data:L,isSuccess:h,isLoading:E,error:j,reset:v}]=$(),[B]=q(),M=a=>{window.confirm("Apakah anda yakin menghapus mata pelajaran, bab, topik dan file?")&&y(a)},s=(a,r,l)=>{const g=a.replace(/\s+/g,"-");n(`/lms-mapel/${l}/${g}/${r}`)},w=()=>{window.confirm("Apakah anda yakin akan menghapus database mapel?")&&B()};return t.useEffect(()=>{h&&(o.success(L.message),v(),window.location.reload()),j&&(o.error(j.data.message),v())},[L,h,j]),e.jsx(I,{title:"Mata Pelajaran",children:e.jsxs("div",{className:"row",style:{height:"100%"},children:[e.jsx("div",{className:"col-lg-3 col-12",children:e.jsx(J,{detail:N,id:i})}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsxs(z,{page:c,setLimit:a=>b(a),setPage:a=>x(a),onValue:a=>f(a),totalPages:D,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("p",{className:"m-0",children:["Total Mata Pelajaran: ",e.jsx("span",{children:S})]}),e.jsx("button",{className:"btn btn-danger",onClick:w,children:"Kosongkan Data"})]}),e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{children:e.jsx("tr",{children:P==null?void 0:P.map(a=>e.jsx("th",{className:"text-center",scope:"col",children:a.label},a.label))})}),e.jsx("tbody",{children:u.map((a,r)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",className:"text-center align-middle",children:(c-1)*d+r+1}),e.jsx("td",{className:"text-center align-middle",children:a.code}),e.jsx("td",{className:"text-center align-middle",children:a.homebase_name}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"align-middle",children:a.levelCounts.length>0?a.levelCounts.map((l,g)=>e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-3 text-muted",children:[e.jsxs("p",{className:"m-0",children:["Tingkat: ",e.jsx("span",{children:l.level})]}),e.jsxs("p",{className:"m-0",children:["kelas: ",e.jsx("span",{children:l.classes.join(", ")})]})]}),e.jsxs("div",{className:"d-flex gap-3 text-muted",children:[e.jsxs("p",{className:"m-0",children:["Bab: ",e.jsx("span",{children:l.total_chapters})]}),e.jsxs("p",{className:"m-0",children:["Topik: ",e.jsx("span",{children:l.total_topics})]})]})]},g)):e.jsx("p",{className:"text-muted m-0",children:"Data belum tersedia"})}),e.jsx("td",{className:"align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>s(a.name,a.code,a.id),children:"Detail"}),e.jsx("button",{className:"btn btn-warning",onClick:()=>C(a.id),children:"Edit"}),E?e.jsx(A,{}):e.jsx("button",{className:"btn btn-danger",onClick:()=>M(a.code),children:"Hapus"})]})})]},a.id))})]})]})})]})})};export{te as default};
