import{i as U,r as l,A as Y,C as B,D as Z,E as q,y as G,j as e,F as T,l as X,G as ee}from"./index-DMvCZNdX.js";import{L as ae}from"./Layout-BpGWwOWy.js";import{T as z}from"./TabelContainer-Df-0NVOq.js";import{u as J,w as se}from"./xlsx-R0LD_mVJ.js";import"./Menus-C_0QUNbK.js";import"./Menus-CeiNyHsH.js";import"./index-mJC8lMn1.js";const te=[{label:"No"},{label:"NIS"},{label:"Nama Siswa"},{label:"Kelas"},{label:"Login"},{label:"Ip Address"},{label:"Browser"},{label:"Status"},{label:"Reset"}],ne=({tableRef:p})=>{const r=U(),i=r.bankid,m=r.gradeid,[o,f]=l.useState(1),[b,C]=l.useState(10),[I,w]=l.useState(""),[S,h]=l.useState(),{data:N={}}=Y({page:o,limit:b,search:I,class_code:S,quizId:i}),{logs:u=[],totalPages:L,total:M}=N,{data:c}=B(m),[n,{data:g,isSuccess:_,isLoading:s,error:d}]=Z(),[R,{data:E,isSuccess:j,error:y,isLoading:v}]=q(),k=(t,P,a)=>{const x={nis:parseInt(t),logId:parseInt(P),quizId:parseInt(i)};window.confirm(`Apa ${a} akan mengulang ujian?`)&&n(x)},$=(t,P,a)=>{const x={nis:parseInt(t),logId:parseInt(P),quizId:parseInt(i)};window.confirm(`Apa anda yakin akan menghapus seluruh jawaban ${a} pada ujian ini?`)&&R(x)};return l.useEffect(()=>{_&&G.success(g.message),d&&G.error(d.data.message)},[g,_,d]),l.useEffect(()=>{j&&G.success(E.message),y&&G.error(y.data.message)},[E,j,y]),e.jsxs(z,{page:o,setPage:t=>f(t),setLimit:t=>C(t),onValue:t=>w(t),totalPages:L,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("p",{className:"m-0 h6",children:["Jumlah Siswa: ",e.jsx("span",{children:M})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end flex-wrap gap-1",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(""),children:"Reset"}),c==null?void 0:c.map(t=>e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(t.code),children:t.name},t.id))]})]}),e.jsxs("table",{ref:p,className:"table table-striped table-hover",children:[e.jsx("thead",{children:e.jsx("tr",{children:te.map((t,P)=>e.jsx("th",{scope:"col",className:"text-center",children:t.label},P))})}),e.jsx("tbody",{children:u.map((t,P)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(o-1)*b+P+1}),e.jsx("td",{className:"text-center align-middle",children:t.nis}),e.jsx("td",{className:"align-middle",children:t.name}),e.jsx("td",{className:"text-center align-middle",children:t.class_name}),e.jsx("td",{className:"text-center align-middle",children:new Date(t.log_in).toLocaleDateString("id-ID",{hour:"numeric",minute:"numeric",second:"numeric"})}),e.jsx("td",{className:"text-center align-middle",children:t.ip}),e.jsx("td",{className:"text-center align-middle",children:t.browser}),e.jsx("td",{className:"text-center align-middle",children:t.isDone?e.jsx("p",{className:"m-0 text-danger fw-bold",children:"Selesai"}):e.jsx("p",{className:"m-0 text-success fw-bold",children:"Mengerjakan"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-warning",onClick:()=>$(t.nis,t.id,t.name),disabled:!t.isDone,children:"Ulang"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>k(t.nis,t.id,t.name),disabled:!t.isActive,children:"Reset"})]})})]},t.id))})]})]})},le=[{label:"No"},{label:"NIS"},{label:"Nama Siswa"},{label:"Kelas"}],ce=[{label:"Benar"},{label:"Salah"},{label:"Nilai"}],ie=({tableRef:p})=>{var g,_;const r=U(),i=r.bankid,m=r.gradeid,[o,f]=l.useState(1),[b,C]=l.useState(10),[I,w]=l.useState(""),[S,h]=l.useState(""),{data:N={}}=T({quizId:i,gradeId:m,page:o,limit:b,search:I,code:S}),{results:u=[],totalPages:L,totalData:M}=N,{data:c}=X(i,{skip:!i}),{data:n}=B(m);return e.jsxs(z,{page:o,setPage:s=>f(s),setLimit:s=>C(s),onValue:s=>w(s),totalPages:L,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("p",{className:"m-0 h6",children:["Jumlah Siswa: ",e.jsx("span",{children:M})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end flex-wrap gap-1",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(""),children:"Reset"}),n==null?void 0:n.map(s=>e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(s.code),children:s.name},s.id))]})]}),e.jsxs("table",{ref:p,className:"table table-striped table-hover",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[le.map((s,d)=>e.jsx("th",{rowSpan:2,scope:"col",className:"align-middle text-center",children:s.label},d)),(g=c==null?void 0:c.filter(s=>s.type===1))==null?void 0:g.map((s,d)=>e.jsx("th",{scope:"col",className:"text-center",children:d+1},d)),ce.map((s,d)=>e.jsx("th",{rowSpan:2,scope:"col",className:"align-middle text-center",children:s.label},d))]}),e.jsx("tr",{children:(_=c==null?void 0:c.filter(s=>s.type===1))==null?void 0:_.map((s,d)=>e.jsx("th",{scope:"col",className:"text-center",children:s.key},d))})]}),e.jsx("tbody",{children:u==null?void 0:u.map((s,d)=>{var R,E;return e.jsxs(l.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{rowSpan:2,className:"align-middle text-center",children:(o-1)*b+d+1}),e.jsx("td",{rowSpan:2,className:"align-middle text-center",children:s.nis}),e.jsx("td",{rowSpan:2,className:"align-middle ",children:s.name}),e.jsx("td",{rowSpan:2,className:"align-middle text-center",children:s.class}),(R=c==null?void 0:c.filter(j=>j.type===1))==null?void 0:R.map((j,y)=>{const v=s.answers.find(k=>k.questionId===j.id);return e.jsx("td",{className:"align-middle text-center",children:v?v.mc:"-"},y)}),e.jsx("td",{rowSpan:2,className:"align-middle text-center",children:s.correct}),e.jsx("td",{rowSpan:2,className:"align-middle text-center",children:s.wrong}),e.jsx("td",{rowSpan:2,className:"align-middle text-center",children:s.mcPoin})]},d),e.jsx("tr",{children:(E=c==null?void 0:c.filter(j=>j.type===1))==null?void 0:E.map((j,y)=>{const v=s.answers.find(k=>k.questionId===j.id);return e.jsx("td",{className:`align-middle text-center ${(v==null?void 0:v.poin)==0?"text-danger":"text-success "} fw-bold`,children:v?v.poin:"-"},y)})})]},d)})})]})]})},W=p=>({__html:p}),de=[{label:"No"},{label:"NIS"},{label:"Nama Siswa"},{label:"Kelas"},{label:"Nilai"},{label:"Aksi"}],re=({tabelRef:p})=>{const r=U(),i=r.bankid,m=r.gradeid,[o,f]=l.useState(1),[b,C]=l.useState(10),[I,w]=l.useState(""),[S,h]=l.useState(""),[N,u]=l.useState(""),[L,M]=l.useState({}),{data:c={}}=T({quizId:i,gradeId:m,page:o,limit:b,search:I,code:S}),{results:n=[],totalPages:g,totalData:_}=c,{data:s}=X(i,{skip:!i}),{data:d}=B(m),R=s==null?void 0:s.filter(a=>a.type===2),[E,{data:j,isSuccess:y,isLoading:v,error:k,reset:$}]=ee(),t=(a,x)=>{M(D=>({...D,[a]:x}))},P=async()=>{const a=Object.entries(L).map(([x,D])=>({questionId:x,poin:D}));await Promise.all(a.map(({questionId:x,poin:D})=>{E({id:x,body:{poin:D,nis:N.nis,gradeId:m,quizId:i}})}))};return l.useEffect(()=>{y&&(G.success(j.message),$(),u("")),k&&(G.error(k.data.message),$(),console.log(k))},[j,y,k]),e.jsxs(z,{page:o,setPage:a=>f(a),setLimit:a=>C(a),onValue:a=>w(a),totalPages:g,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("p",{className:"m-0 h6",children:["Jumlah Siswa: ",e.jsx("span",{children:_})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end flex-wrap gap-1",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(""),children:"Reset"}),d==null?void 0:d.map(a=>e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(a.code),children:a.name},a.id))]})]}),e.jsxs("table",{ref:p,className:"table table-striped table-hover",children:[e.jsx("thead",{children:e.jsx("tr",{children:de.map((a,x)=>e.jsx("th",{scope:"col",className:"text-center",children:a.label},x))})}),e.jsx("tbody",{children:n==null?void 0:n.map((a,x)=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle text-center",children:(o-1)*b+x+1}),e.jsx("td",{className:"align-middle text-center",children:a.nis}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"align-middle text-center",children:a.class}),e.jsx("td",{className:"align-middle text-center",children:a.essayPoin}),e.jsx("td",{className:"align-middle text-center",children:e.jsx("button",{className:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#nilai",onClick:()=>u(a),children:"Koreksi"})})]},x))})]}),e.jsx("div",{className:"modal fade",id:"nilai",tabIndex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",id:"exampleModalLabel",children:["Jawaban Essay ",e.jsx("span",{children:N.name})]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body d-flex flex-column gap-2",children:R==null?void 0:R.map((a,x)=>{var H,K,Q,V,F,O;const D=(K=(H=N.answers)==null?void 0:H.find(A=>A.questionId===a.id))==null?void 0:K.essay;return e.jsx("div",{className:"d-flex gap-1 rounded shadow p-2",children:e.jsxs("div",{className:"d-flex flex-column gap-1 p-2",children:[e.jsx("p",{className:"m-0",dangerouslySetInnerHTML:W(a.question)}),e.jsxs("p",{className:"m-0 fst-italic",children:["Jawaban:"," ",e.jsx("span",{dangerouslySetInnerHTML:W(D)})]}),e.jsx("input",{type:"numeric",className:"form-control",placeholder:"Nilai",value:L[a.id]!==void 0?L[a.id]:((V=(Q=N.answers)==null?void 0:Q.find(A=>A.questionId===a.id))==null?void 0:V.poin)!==void 0?(O=(F=N.answers)==null?void 0:F.find(A=>A.questionId===a.id))==null?void 0:O.poin:0,onChange:A=>t(a.id,A.target.value)})]})},x)})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"tutup"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:P,children:"Simpan"})]})]})})})]})},oe=[{label:"No"},{label:"NIS"},{label:"Nama Siswa"},{label:"Kelas"},{label:"Pilihan Ganda"},{label:"Uraian"},{label:"Nilai"}],me=({tableRef:p})=>{const r=U(),i=r.bankid,m=r.gradeid,[o,f]=l.useState(1),[b,C]=l.useState(10),[I,w]=l.useState(""),[S,h]=l.useState(""),{data:N={}}=T({quizId:i,gradeId:m,page:o,limit:b,search:I,code:S}),{results:u=[],totalPages:L,totalData:M}=N,{data:c}=B(m);return e.jsxs(z,{page:o,setPage:n=>f(n),setLimit:n=>C(n),onValue:n=>w(n),totalPages:L,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("p",{className:"m-0 h6",children:["Jumlah Siswa: ",e.jsx("span",{children:M})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end flex-wrap gap-1",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(""),children:"Reset"}),c==null?void 0:c.map(n=>e.jsx("button",{className:"btn btn-secondary",onClick:()=>h(n.code),children:n.name},n.id))]})]}),e.jsxs("table",{ref:p,className:"table table-striped table-hover",children:[e.jsx("thead",{children:e.jsx("tr",{children:oe.map((n,g)=>e.jsx("th",{scope:"col",className:"text-center",children:n.label},g))})}),e.jsx("tbody",{children:u==null?void 0:u.map((n,g)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:(o-1)*b+g+1}),e.jsx("td",{className:"text-center",children:n.nis}),e.jsx("td",{children:n.name}),e.jsx("td",{className:"text-center",children:n.class}),e.jsx("td",{className:"text-center",children:n.mcPoin}),e.jsx("td",{className:"text-center",children:n.essayPoin}),e.jsx("td",{className:"text-center",children:n.totalPoin})]},g))})]})]})},Ne=()=>{const p=U(),r=l.useRef(null),[i,m]=l.useState("log"),o=()=>{if(r.current){const f=J.book_new(),b=r.current,C=J.table_to_sheet(b);J.book_append_sheet(f,C,"Sheet1");const I=se(f,{bookType:"xlsx",type:"array"}),w=new Blob([I],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),S=`${i}_${p.name}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(w,S);else{const h=document.createElement("a");h.href=window.URL.createObjectURL(w),h.download=S,h.click()}}};return e.jsx(ae,{title:`Laporan Ujian ${p.name}`,children:e.jsx("div",{className:"row",style:{height:"100%"},children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex flex-wrap align-items-center justify-content-end gap-2 p-2 rounded shadow mb-2",children:[e.jsx("button",{className:"btn btn-warning",children:"Perbarui Data"}),e.jsx("button",{className:"btn btn-info",onClick:()=>m("log"),children:"Log"}),e.jsx("button",{className:"btn btn-info",onClick:()=>m("pg"),children:"Pilhan Ganda"}),e.jsx("button",{className:"btn btn-info",onClick:()=>m("uraian"),children:"Uraian"}),e.jsx("button",{className:"btn btn-info",onClick:()=>m("nilai"),children:"Nilai"}),e.jsx("button",{className:"btn btn-success",onClick:o,children:"Unduh Data"})]}),e.jsxs("div",{style:{height:"calc(100vh - 150px)",overflow:"auto"},className:"rounded shadow",children:[i==="log"&&e.jsx(ne,{tableRef:r}),i==="pg"&&e.jsx(ie,{tableRef:r}),i==="uraian"&&e.jsx(re,{tabelRef:r}),i==="nilai"&&e.jsx(me,{tableRef:r})]})]})})})};export{Ne as default};
