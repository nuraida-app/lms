import{r as p,a0 as q,aM as Q,aN as G,aO as R,aP as B,y as F,j as e,aQ as O,aR as U,aS as V,i as H,aT as J,aU as W}from"./index-BmFd-R0Z.js";const z=t=>{const r=new Date(t);if(isNaN(r.getTime()))return"";const i=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),m=String(r.getDate()).padStart(2,"0");return`${i}-${a}-${m}`},X=({provinces:t,name:r,nis:i,student:a})=>{const m="",x="",g="",[l,P]=p.useState(""),[o,L]=p.useState(""),[j,N]=p.useState(""),[y,T]=p.useState(""),{data:D={}}=q({page:m,limit:x,search:g}),{data:S=[]}=D,{data:v}=Q(o,{skip:!o}),{data:C}=G(j,{skip:!j}),{data:w}=R(y,{skip:!y}),[c,{data:f,isSuccess:k,isLoading:I,error:$,reset:K}]=B(),[d,A]=p.useState({year_id:"",year:"",name:r,nisn:"",nis:i,birth_place:"",birth_date:"",height:0,weight:0,around_head:0,order_birth:0,siblings:1,province_id:"",province_name:"",regency_id:"",regency_name:"",district_id:"",district_name:"",village_id:"",village_name:"",district:"",address:"",postal_code:""}),h=n=>{const{name:b,value:u}=n.target;if(b==="year_id"){const _=S==null?void 0:S.find(s=>s.id==u);P(parseInt(u,10)),A(s=>({...s,year_id:l,year:_?_.name:""}))}if(b==="province_id"){const _=t==null?void 0:t.find(s=>s.id===u);L(u),A(s=>({...s,province_id:u,province_name:_?_.name:"",regency_id:"",district_id:"",village_id:""}))}if(b==="regency_id"){const _=v==null?void 0:v.find(s=>s.id===u);N(u),A(s=>({...s,regency_id:u,regency_name:_?_.name:"",district_id:"",village_id:""}))}if(b==="district_id"){const _=C==null?void 0:C.find(s=>s.id===u);T(u),A(s=>({...s,district_id:u,district_name:_?_.name:"",village_id:""}))}if(b==="village_id"){const _=w==null?void 0:w.find(s=>s.id===u);A(s=>({...s,village_id:u,village_name:_?_.name:""}))}b!=="province_id"&&b!=="regency_id"&&b!=="district_id"&&b!=="village_id"&&b!=="year"&&A(_=>({..._,[b]:u}))},Y=n=>{n.preventDefault(),c(d)};return p.useEffect(()=>{k&&(F.success(f.message),K()),$&&(F.error($.data.message),K())},[k,$,f]),p.useEffect(()=>{a&&(A({year_id:a.year_id,year:a.year,name:a.name,nisn:a.nisn,nis:a.nis,birth_place:a.birth_place,birth_date:z(a.birth_date),height:a.height,weight:a.weight,around_head:a.around_head,order_birth:a.order_birth,siblings:a.siblings,province_id:a.province_id.trim(),province_name:a.province_name,regency_id:a.regency_id.trim(),regency_name:a.regency_name,district_id:a.district_id.trim(),district_name:a.district_name,village_id:a.village_id.trim(),village_name:a.village_name,address:a.address,postal_code:a.postal_code}),L(a.province_id.trim()),N(a.regency_id.trim()),T(a.district_id.trim()))},[a]),e.jsxs("form",{className:"p-2 rounded border shadow bg-white mt-2 row g-2",children:[e.jsxs("div",{className:"col-md-6 col-12 d-flex flex-column gap-3",children:[e.jsxs("select",{className:"form-select","aria-label":"Default select example",name:"year_id",required:!0,value:d.year_id||"",onChange:h,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Tahun Pelajaran"}),S==null?void 0:S.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsx("input",{type:"text",name:"name",id:"1",className:"form-control",placeholder:"Nama Lengkap",required:!0,value:d.name||"",onChange:h}),e.jsx("input",{type:"text",name:"nisn",id:"2",className:"form-control",placeholder:"NISN",required:!0,value:d.nisn||"",onChange:h}),e.jsx("input",{type:"text",name:"nis",id:"3",className:"form-control",placeholder:"NIS",required:!0,value:d.nis||"",onChange:h}),e.jsx("input",{type:"text",name:"birth_place",id:"4",className:"form-control",placeholder:"Tempat Lahir",required:!0,value:d.birth_place||"",onChange:h}),e.jsx("input",{type:"date",name:"birth_date",id:"5",className:"form-control",placeholder:"Tanggal Lahir",required:!0,value:d.birth_date||"",onChange:h}),e.jsx("input",{type:"number",name:"order_birth",id:"6",className:"form-control",placeholder:"Urutan Kelahiran",value:d.order_birth||"",onChange:h}),e.jsx("input",{type:"number",name:"height",id:"7",className:"form-control",placeholder:"TB",value:d.height||"",onChange:h}),e.jsx("input",{type:"number",name:"weight",id:"8",className:"form-control",placeholder:"BB",value:d.weight||"",onChange:h}),e.jsx("input",{type:"number",name:"around_head",id:"9",className:"form-control",placeholder:"Lingkar Kepala",value:d.around_head||"",onChange:h})]}),e.jsxs("div",{className:"col-md-6 col-12 d-flex flex-column gap-3",children:[e.jsxs("select",{className:"form-select","aria-label":"Default select example",name:"province_id",value:d.province_id||"",onChange:h,children:[e.jsx("option",{value:"",children:"Pilih Provinsi"}),t==null?void 0:t.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsxs("select",{className:"form-select","aria-label":"Default select example",name:"regency_id",value:d.regency_id||"",onChange:h,children:[e.jsx("option",{value:"",children:"Pilih Kota / Kabupaten"}),v==null?void 0:v.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsxs("select",{className:"form-select","aria-label":"Default select example",name:"district_id",value:d.district_id||"",onChange:h,children:[e.jsx("option",{value:"",children:"Pilih Kecamatan"}),C==null?void 0:C.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsxs("select",{className:"form-select","aria-label":"Default select example",name:"village_id",value:d.village_id||"",onChange:h,children:[e.jsx("option",{value:"",children:"Pilih Desa"}),w==null?void 0:w.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsx("input",{type:"text",name:"postal_code",id:"11",className:"form-control",placeholder:"Kode Pos",value:d.postal_code||"",onChange:h}),e.jsx("textarea",{name:"adress",id:"10",rows:"6",className:"form-control",placeholder:"Alamat",value:d.address||"",onChange:h})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{className:"btn btn-success",onClick:Y,disabled:!!I,children:I?"loading...":"Simpan"})})]})},M=t=>t!=null&&t.startsWith("0")?`62${t.slice(1)}`:t,E=t=>{const r=new Date(t);if(isNaN(r.getTime()))return"";const i=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),m=String(r.getDate()).padStart(2,"0");return`${i}-${a}-${m}`},Z=({student:t})=>{const[r,{data:i,isSuccess:a,isLoading:m,error:x,reset:g}]=O(),[l,P]=p.useState({father_nik:"",father_name:"",father_birth_place:"",father_birth_date:"",father_job:"",father_phone:"",mother_nik:"",mother_name:"",mother_birth_place:"",mother_birth_date:"",mother_job:"",mother_phone:"",nis:""}),o=j=>{const{name:N,value:y}=j.target;P({...l,[N]:N==="father_phone"||N==="mother_phone"?M(y):y})},L=j=>{j.preventDefault(),r(l)};return p.useEffect(()=>{a&&(F.success(i.message),g()),x&&(F.error(x.data.message),g())},[a,x,i]),p.useEffect(()=>{t&&P({father_nik:t.father_nik,father_name:t.father_name,father_birth_place:t.father_birth_place,father_birth_date:E(t.father_birth_date),father_job:t.father_job,father_phone:M(t.father_phone),mother_nik:t.mother_nik,mother_name:t.mother_name,mother_birth_place:t.mother_birth_place,mother_birth_date:E(t.mother_birth_date),mother_job:t.mother_job,mother_phone:M(t.mother_phone),nis:t.nis})},[t]),e.jsxs("form",{className:"p-2 rounded border shadow bg-white mt-2 row g-2",onSubmit:L,children:[e.jsxs("div",{className:"col-md-6 col-12 d-flex flex-column gap-2",children:[e.jsx("input",{type:"text",name:"father_nik",id:"1",className:"form-control",placeholder:"NIK Ayah",value:l.father_nik||"",onChange:o}),e.jsx("input",{type:"text",name:"father_name",id:"2",className:"form-control",placeholder:"Nama Ayah",value:l.father_name||"",onChange:o}),e.jsx("input",{type:"text",name:"father_birth_place",id:"3",className:"form-control",placeholder:"Tempat Lahir Ayah",value:l.father_birth_place||"",onChange:o}),e.jsx("input",{type:"date",name:"father_birth_date",id:"4",className:"form-control",placeholder:"Tanggal Lahir Ayah",value:l.father_birth_date||"",onChange:o}),e.jsx("input",{type:"text",name:"father_job",id:"5",className:"form-control",placeholder:"Pekerjaan Ayah",value:l.father_job||"",onChange:o}),e.jsx("input",{type:"number",name:"father_phone",id:"6",className:"form-control",placeholder:"Tlp Ayah",value:l.father_phone||"",onChange:o})]}),e.jsxs("div",{className:"col-md-6 col-12 d-flex flex-column gap-2",children:[e.jsx("input",{type:"text",name:"mother_nik",id:"1",className:"form-control",placeholder:"NIK Ayah",value:l.mother_nik||"",onChange:o}),e.jsx("input",{type:"text",name:"mother_name",id:"2",className:"form-control",placeholder:"Nama Ayah",value:l.mother_name||"",onChange:o}),e.jsx("input",{type:"text",name:"mother_birth_place",id:"3",className:"form-control",placeholder:"Tempat Lahir Ayah",value:l.mother_birth_place||"",onChange:o}),e.jsx("input",{type:"date",name:"mother_birth_date",id:"4",className:"form-control",placeholder:"Tanggal Lahir Ayah",value:l.mother_birth_date||"",onChange:o}),e.jsx("input",{type:"text",name:"mother_job",id:"5",className:"form-control",placeholder:"Pekerjaan Ayah",value:l.mother_job||"",onChange:o}),e.jsx("input",{type:"number",name:"mother_phone",id:"6",className:"form-control",placeholder:"Tlp Ayah",value:l.mother_phone||"",onChange:o})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{type:"submit",className:"btn btn-success",children:"Simpan"})})]})},ee=t=>{const r=new Date(t);if(isNaN(r.getTime()))return"";const i=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),m=String(r.getDate()).padStart(2,"0");return`${i}-${a}-${m}`};function ae(t){const r=new Date,i=new Date(t);let a=r.getFullYear()-i.getFullYear();const m=r.getMonth()-i.getMonth();return(m<0||m===0&&r.getDate()<i.getDate())&&a--,a}const te=({student:t})=>{const[r,{isSuccess:i,data:a,isLoading:m,error:x,reset:g}]=U(),[l,{isSuccess:P,data:o,isLoading:L,error:j,reset:N}]=V(),[y,T]=p.useState((t==null?void 0:t.family_info)||[]),[D,S]=p.useState({family_name:"",family_gender:"",family_birth_date:""}),v=c=>{const{name:f,value:k}=c.target;S({...D,[f]:k})},C=c=>{c.preventDefault();const f={family_name:D.family_name,family_gender:D.family_gender,family_birth_date:D.family_birth_date,id:Date.now()},k={nis:t.nis,familyData:[...y,f]};r(k).unwrap().then(()=>{T(I=>[...I,f]),S({family_name:"",family_gender:"",family_birth_date:""})})},w=c=>{const f={nis:t.nis,familyId:c};l(f).unwrap().then(()=>{T(y.filter(k=>k.id!==c))})};return p.useEffect(()=>{i&&(F.success(a.message),g()),x&&(F.error(x.data.message),g())},[i,x,g,a]),p.useEffect(()=>{P&&(F.success(o.message),N()),j&&(F.error(j.data.message),N())},[P,j,o]),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3 col-12",children:e.jsxs("form",{action:"",className:"d-flex flex-column gap-2 rounded border shadow p-2 bg-white",onSubmit:C,children:[e.jsx("input",{type:"text",name:"family_name",id:"1",className:"form-control",placeholder:"Nama Keluarga",required:!0,value:D.family_name||"",onChange:v}),e.jsxs("select",{name:"family_gender",id:"2",className:"form-select",value:D.family_gender||"",onChange:v,children:[e.jsx("option",{value:"Male",children:"Laki Laki"}),e.jsx("option",{value:"Female",children:"Perempuan"})]}),e.jsx("input",{type:"date",name:"family_birth_date",id:"3",className:"form-control",value:D.family_birth_date||"",onChange:v}),e.jsx("button",{type:"submit",className:"btn btn-success",disabled:!!m,children:m?"Loading...":"Simpan"})]})}),e.jsx("div",{className:"col-md-9 col-12",children:e.jsx("div",{className:"table-responsive bg-white p-2 rounded border shadow",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{children:e.jsx("tr",{children:["No","Nama","Jenis Kelamin","Tanggal Lahir","usia","Aksi"].map(c=>e.jsx("th",{className:"text-center",children:c},c))})}),e.jsx("tbody",{children:y==null?void 0:y.map((c,f)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:f+1}),e.jsx("td",{className:"align-middle",children:c.family_name}),e.jsx("td",{className:"text-center align-middle",children:c.family_gender==="Female"?"Perempuan":"Laki Laki"}),e.jsx("td",{className:"text-center align-middle",children:ee(c.family_birth_date)}),e.jsx("td",{className:"text-center align-middle",children:`${ae(c.family_birth_date)} thn`}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("button",{className:"btn btn-danger",onClick:()=>w(c.id),disabled:!!L,children:L?"Loading...":"- Hapus"})})]},f))})]})})})]})},ne=()=>{const t=H(),{name:r,nis:i}=t,[a,m]=p.useState(1),{data:x}=J(),{data:g}=W(i,{skip:!i});return e.jsxs("div",{children:[e.jsxs("div",{className:"row rounded p-2 border shadow bg-white m-2 g-1",children:[e.jsx("div",{className:"col-md-6 col-12 d-flex align-items-center",children:e.jsx("p",{className:"m-0 h5",children:r.replace(/\-/g," ")})}),e.jsx("div",{className:"col-md-6 col-12",children:e.jsxs("select",{name:"type",id:"122",className:"form-select",value:a||"",onChange:l=>m(l.target.value),children:[e.jsx("option",{value:1,children:"Data Siswa"}),e.jsx("option",{value:2,children:"Data Orang tua"}),e.jsx("option",{value:3,children:"Data Keluarga"})]})})]}),e.jsxs("div",{className:"container-fluid",children:[a==1&&e.jsx(X,{provinces:x,name:r.replace(/\-/g," "),nis:i,student:g}),a==2&&e.jsx(Z,{student:g}),a==3&&e.jsx(te,{student:g})]})]})};export{ne as F};
