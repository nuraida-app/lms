import{r as s,a9 as Y,a3 as J,aa as V,y as r,j as e,ab as z,ac as K}from"./index-DnLSs86n.js";import{L as O}from"./Layout-C308tWzO.js";import{T as W}from"./TabelContainer-0T-vlQNa.js";import{r as X,u as Z}from"./xlsx-R0LD_mVJ.js";import"./index-DESm-F1K.js";const $=({student:l,clear:f})=>{const o="",w="",N="",[k,d]=s.useState(""),[m,u]=s.useState(""),[h,i]=s.useState(""),[x,n]=s.useState(""),[S,y]=s.useState(null),[C,{data:b,isSuccess:p,isLoading:D,error:c,reset:j}]=Y(),{data:t={}}=J({page:o,limit:w,search:N}),{data:g=[]}=t,[P,{data:E,isSuccess:T,isLoading:ee,error:L,reset:A}]=V(),I=a=>{if(a.preventDefault(),!h||!x||!m){r.error("Semua data harus diisi");return}C({id:k,nis:x,name:h,yearid:m})},F=()=>{window.open("/temp/siswa_template.xlsx","_blank")},H=a=>{y(a.target.files[0])},_=()=>{if(S){const a=new FileReader;a.onload=v=>{const M=new Uint8Array(v.target.result),B=X(M,{type:"array"}),R=B.SheetNames[0],U=B.Sheets[R],G={data:Z.sheet_to_json(U,{header:1,range:1}).filter(Q=>Q.length>0)};P(G)},a.readAsArrayBuffer(S)}},q=()=>{d(""),i(""),n(""),u(""),f()};return s.useEffect(()=>{p&&(r.success(b.message),j(),d(""),i(""),u(""),n("")),c&&(r.error(c.data.message),j())},[b,p,c]),s.useEffect(()=>{T&&(r.success(E.message),A(),y(null)),L&&(r.error(L.data.message),A())},[E,T,L]),s.useEffect(()=>{l&&(d(l.id),i(l.name),n(l.nis))},[l]),e.jsxs("div",{className:"mt-2 p-2 shadow rounded d-flex flex-column gap-2 bg-white border border-2",children:[e.jsx("p",{className:"h5",children:"Tambahkan Peseta Didik"}),e.jsxs("form",{className:"d-flex flex-column gap-2",onSubmit:I,children:[e.jsxs("select",{name:"yearid",id:"1",className:"form-select",required:!0,value:m||"",onChange:a=>u(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Tahun Ajar"}),g==null?void 0:g.map((a,v)=>e.jsx("option",{value:a.id,children:a.name},v))]}),e.jsx("input",{type:"number",name:"name",id:"2",placeholder:"NIS",className:"form-control",value:x||"",onChange:a=>n(a.target.value),required:!0}),e.jsx("input",{type:"text",name:"name",id:"3",placeholder:"Nama Lengkap",className:"form-control",value:h||"",onChange:a=>i(a.target.value),required:!0}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-danger",onClick:q,children:"Batal"}),e.jsx("button",{type:"button",className:"btn btn-info","data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",children:"upload"}),e.jsx("button",{type:"submit",className:"btn btn-success",children:D?"Loading...":"+ Tambahkan"})]})]}),e.jsx("div",{className:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"staticBackdropLabel",children:"Pilih file"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body d-flex flex-column align-items-end gap-2",children:e.jsx("input",{type:"file",name:"file",className:"form-control",onChange:H})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-warning",onClick:F,children:"Template"}),e.jsx("button",{type:"button",className:"btn btn-danger","data-bs-dismiss":"modal",children:"Tutup"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:_,children:"Unggah"})]})]})})})]})},ie=()=>{const[l,f]=s.useState({}),[o,w]=s.useState(1),[N,k]=s.useState(15),[d,m]=s.useState(""),u="",h="",i="",{data:x={}}=z({page:o,limit:N,search:d,homebase:u,gradeId:h,classCode:i}),{students:n,totalPages:S,totalStudents:y}=x,[C,{data:b,isSuccess:p,isLoading:D,error:c,reset:j}]=K();return s.useEffect(()=>{p&&(r.success(b.message),j()),c&&(r.error(c.data.message),j())},[b,p,c]),e.jsx(O,{title:"Daftar Siswa",children:e.jsxs("div",{className:"row",style:{height:"100%"},children:[e.jsx("div",{className:"col-lg-3 col-12",children:e.jsx($,{student:l,clear:()=>f({})})}),e.jsx("div",{className:"col-lg-9 col-12",style:{height:"100%",overflow:"auto"},children:e.jsxs(W,{page:o,setPage:t=>w(t),setLimit:t=>k(t),onValue:t=>m(t),totalPages:S,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between my-1",children:[e.jsxs("h6",{className:"m-0",children:["Jumlah Siswa ",e.jsx("span",{children:y})]}),e.jsx("button",{className:"btn btn-danger",children:"Hapus Data"})]}),e.jsxs("table",{className:"table table-striped table-hover mt-2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"text-center",children:"#"}),e.jsx("th",{scope:"col",className:"text-center",children:"Tahun Ajar"}),e.jsx("th",{scope:"col",className:"text-center",children:"NIS"}),e.jsx("th",{scope:"col",className:"text-center",children:"Nama Siswa"}),e.jsx("th",{scope:"col",className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:n==null?void 0:n.map((t,g)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",className:"text-center",children:(o-1)*N+g+1}),e.jsx("td",{className:"text-center align-middle",children:t.year}),e.jsx("td",{className:"text-center align-middle",children:t.nis}),e.jsx("td",{className:"align-middle",children:t.name}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-warning",onClick:()=>f(t),children:"Edit"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>C(t.id),children:D?"Loading...":"Hapus"})]})})]},t.id))})]})]})})]})})};export{ie as default};
