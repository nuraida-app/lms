import{e as L,a$ as A,r as d,j as s,b0 as P,b1 as O,y as w,b2 as $,i as D,u as H,l as J,b3 as G,b4 as R,M as F}from"./index-DnLSs86n.js";import{E as K}from"./Editor-BWhdkTE2.js";import"./quill.snow-BsA9vCN4.js";import"./index-Chjiymov.js";const V=({name:e,quizName:m,bankid:c,nis:h})=>{const a=L(),{data:l}=A({nis:h,quiz:c},{skip:!h||!c});return d.useEffect(()=>{l!=null&&l.isDone&&a("/cbt-jawdal-ujian")},[l]),s.jsxs("div",{className:"bg-primary text-white row d-flex align-items-center p-2",children:[s.jsx("div",{className:"col-lg-6 col-12",children:s.jsx("p",{className:"m-0 text-lg-start text-center",children:e})}),s.jsx("div",{className:"col-lg-6 col-12",children:s.jsx("p",{className:"m-0 text-lg-end text-center",children:m.replace("-"," ")})})]})},z=e=>({__html:e}),B=({question:e,note:m,answers:c})=>{const[h,a]=d.useState([]),[l,f]=d.useState(""),[j,{data:b,isSuccess:n,error:t,reset:S}]=P(),[C,{data:g,isSuccess:y,error:N}]=O(),i=c==null?void 0:c.find(r=>r.question_id===(e==null?void 0:e.id));console.log(i);const u=(e==null?void 0:e.type)===1,p=(e==null?void 0:e.type)===2,k=r=>{const v={quizId:e==null?void 0:e.quiz_id,questionId:e==null?void 0:e.id,type:e==null?void 0:e.type,mc:r,poin:e==null?void 0:e.score};j(v)},I=()=>{const r={quizId:e==null?void 0:e.quiz_id,questionId:e==null?void 0:e.id};C(r)},M=()=>{if(l==="")return w.warning("Jawaban essay tidak ada");const r={quizId:e==null?void 0:e.quiz_id,questionId:e==null?void 0:e.id,type:e==null?void 0:e.type,essay:l,poin:e==null?void 0:e.score};j(r)};return d.useEffect(()=>{n&&(w.success(b.message),f(""),S()),t&&(w.error(t.data.message),S())},[b,n,t]),d.useEffect(()=>{y&&w.info(g.message),N&&w.error(N.data.message)},[g,y,N]),d.useEffect(()=>{if(m!=null&&m.shuffle){const r=[...(e==null?void 0:e.choices)||[]].sort(()=>Math.random()-.5);a(r)}else a((e==null?void 0:e.choices)||[])},[m,e]),s.jsxs("div",{className:"row my-3",style:{height:"calc(100vh - 200px)"},children:[s.jsxs("div",{className:"col-lg-5 col-12",style:{height:"100%",overflow:"auto"},children:[u&&s.jsxs("div",{className:"p-2 h-100 border border-2 rounded shadow bg-white d-flex flex-column gap-3",children:[h==null?void 0:h.filter(r=>r.text!=="").map((r,v)=>s.jsxs("div",{className:"d-flex gap-2 py-2 px-1 rounded border border-2",onClick:()=>k(r.value),style:{cursor:"pointer"},children:[s.jsx("input",{type:"radio",className:"form-check-input m-0",checked:(i==null?void 0:i.mc)===r.value,readOnly:!0}),s.jsx("p",{className:"m-0",dangerouslySetInnerHTML:z(r.text)})]},v)),s.jsx("button",{className:`btn ${i!=null&&i.doubt?"btn-warning":"btn-outline-warning"} text-start `,onClick:I,children:"Ragu Ragu"})]}),p&&s.jsxs("div",{className:"d-flex flex-column gap-2",children:[s.jsx(K,{placeholder:"Ketikan jawaban di sini",value:(i==null?void 0:i.essay)||l,onChange:r=>f(r)}),s.jsx("button",{className:"btn btn-primary",onClick:M,children:"Simpan"})]})]}),s.jsx("div",{className:"col-lg-7 col-12",style:{height:"100%",overflow:"auto"},children:s.jsx("div",{className:"p-2 rounded shadow bg-white border border-2",children:s.jsx("div",{className:"p-4",dangerouslySetInnerHTML:z(e==null?void 0:e.question)})})})]})},U=({refresh:e,isLoading:m,number:c,time:h,log:a,bankid:l})=>{const[f,j]=d.useState("00:00:00"),[b,{isSuccess:n,error:t}]=$(),S=()=>{localStorage.removeItem("questions"),e()};return d.useEffect(()=>{n&&(window.location.href="/cbt-jawdal-ujian",localStorage.removeItem("questions")),t&&w.error(t.data.message)},[n,t]),d.useEffect(()=>{if(!(a!=null&&a.log_in))return;const g=new Date(a.log_in).getTime()+h*60*1e3,y=()=>{const i=new Date().getTime(),u=g-i;if(u<=0){j("00:00:00"),b(l);return}const p=String(Math.floor(u/(1e3*60*60))).padStart(2,"0"),k=String(Math.floor(u%(1e3*60*60)/(1e3*60))).padStart(2,"0"),I=String(Math.floor(u%(1e3*60)/1e3)).padStart(2,"0");j(`${p}:${k}:${I}`)};y();const N=setInterval(y,1e3);return()=>clearInterval(N)},[a==null?void 0:a.log_in,h]),s.jsxs("div",{className:"d-flex align-items-center justify-content-between bg-white p-1 rounded shadow border border-2",children:[s.jsxs("div",{className:"d-flex gap-2",children:[s.jsx("button",{style:{width:50},className:"btn btn-info",children:c}),s.jsx("button",{style:{width:50},className:"btn btn-warning",onClick:S,disabled:m,children:s.jsx("i",{className:"bi bi-arrow-repeat"})})]}),s.jsx("button",{className:"btn btn-danger",children:f})]})},q=()=>{const e=D(),{name:m,bankId:c,time:h}=e,[a,l]=d.useState([]),[f,j]=d.useState(1),[b]=d.useState(1),{user:n}=H(x=>x.auth),{data:t,refetch:S,isLoading:C}=J(c,{skip:!c}),{data:g}=G(c,{skip:!c}),[y,{data:N,isSuccess:i,isLoading:u,error:p}]=R(),{data:k}=A({nis:n==null?void 0:n.nis,quiz:c},{skip:!(n!=null&&n.nis)||!c}),I=()=>{S(),t&&Array.isArray(t.questions)&&(localStorage.setItem("questions",JSON.stringify(t)),l(t.questions))},M=f*b,r=M-b,v=a==null?void 0:a.slice(r,M),Q=(x,o)=>{o>=1&&o<=Math.ceil(a.length/b)&&j(o)},T=()=>{y(c)};return d.useEffect(()=>{const x=localStorage.getItem("questions");if(x){const o=JSON.parse(x);Array.isArray(o.questions)?l(o.questions):l([])}else t&&Array.isArray(t.questions)&&(localStorage.setItem("questions",JSON.stringify(t)),l(t.questions))},[t]),d.useEffect(()=>{i&&(window.location.href="/cbt-jawdal-ujian",localStorage.removeItem("questions")),p&&w.error(p.message||p.data.message)},[N,i,p]),s.jsxs("div",{className:"container-fluid",children:[s.jsx(F,{title:m.replace("-"," ")}),s.jsx(V,{name:n==null?void 0:n.name,quizName:m,bankid:c,nis:n==null?void 0:n.nis}),s.jsx("div",{className:"container-fluid my-2",style:{height:"91vh"},children:s.jsxs("div",{className:"row g-2",style:{height:"100%"},children:[s.jsxs("div",{className:"col-lg-10 col-12",children:[s.jsx(U,{refresh:I,isLoading:C,number:f,time:h,log:k,bankid:c}),v==null?void 0:v.map((x,o)=>s.jsx(B,{question:x,note:t==null?void 0:t.note,answers:g},o)),s.jsxs("div",{className:"d-flex align-items-center justify-content-between p-1 rounded shadow bg-white border border-2",children:[s.jsxs("button",{className:"btn btn-primary",onClick:()=>Q(null,f-1),disabled:f===1,children:[s.jsx("i",{className:"bi bi-chevron-left"}),"Sebelumnya"]}),f!==Math.ceil(a.length/b)?s.jsxs("button",{className:"btn btn-primary",onClick:()=>Q(null,f+1),children:["Selanjutnya",s.jsx("i",{className:"bi bi-chevron-right"})]}):s.jsx("button",{className:"btn btn-danger",disabled:!!u,onClick:T,children:u?"Loading...":"Selesai"})]})]}),s.jsx("div",{className:"col-lg-2",children:s.jsx("div",{style:{height:"100%",overflow:"auto"},className:"rounded shadow bg-white p-2 border border-2",children:s.jsx("div",{className:"d-flex gap-2 align-items-start flex-wrap justify-content-center",children:a==null?void 0:a.map((x,o)=>{const E=g==null?void 0:g.find(_=>_.question_id===x.id);return s.jsx("button",{style:{width:50},className:`btn ${E!=null&&E.doubt?"btn-warning":E?"btn-success":"btn-danger"}`,onClick:()=>Q(null,o+1),children:o+1},o)})})})})]})})]})};export{q as default};
