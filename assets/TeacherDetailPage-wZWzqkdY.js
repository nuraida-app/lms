import{M as O,af as ne,r as o,B as z,j as e,C as Y,ah as re,c as Z,a1 as te,ai as le,aj as ie}from"./index-DGvpjgWm.js";import{P as ae}from"./PageName-FtGNY4ev.js";import{L as ce}from"./Layout-CYQNl8g6.js";import{d as oe,a as de,b as q,c as he,e as xe,f as pe,g as je,h as fe}from"./CloudDownloadOutlined-BVhui55s.js";import{P as I}from"./Paper-K36vHTxn.js";import{T as W}from"./TableContainer-BgATlgLf.js";import{T as E,a as b,b as r,c as A}from"./TableRow-DhcfXF1c.js";import{T as M}from"./TableHead-D4fHex_W.js";import{T as U}from"./Typography-DriLene-.js";import{T as K}from"./Tooltip-BTVYJWJP.js";import{I as V}from"./IconButton-pTgfu9-f.js";import{u as B,w as ee}from"./xlsx-DT8pmw08.js";import{B as j}from"./Button-D8VVO348.js";import{M as ue,F as me}from"./Modal-DxRN-owh.js";import{I as se}from"./Input-Eg4Yuw_G.js";import{G as ge}from"./Grid-BGwRTvts.js";import"./FolderCopy-fAMEYysm.js";import"./getThemeProps-DV--MwOD.js";import"./createSvgIcon-DOM3wMaB.js";import"./GlobalStyles-C1DXwv9-.js";import"./listItemIconClasses-hJOZkGUs.js";import"./useTheme-CPtJ_AT7.js";import"./ChevronRight-Bpz3WVJm.js";import"./Storage-BWAOlbSG.js";import"./CalendarMonth-gj1hcJ90.js";import"./Style-BhRVOdmN.js";import"./colorManipulator-BuMbTll3.js";import"./ExitToApp-Drr138pi.js";import"./Toolbar-BD1CLpQT.js";import"./Popper-D89ibtHq.js";import"./Grow-CTPeHix_.js";import"./utils-CSmApv3b.js";const we=[{label:"No",width:30},{label:"NIS",width:100},{label:"Name",width:150},{label:"Class",width:30},{label:"Join",width:110},{label:"IP",width:110},{label:"Browser",width:110},{label:"Status",width:100},{label:"Reset",width:100}],be=({data:l,logs:i})=>{const C=O(),[g,{data:w,isSuccess:x,isLoading:v,error:d}]=ne(),u=(c,s)=>{const t={nis:c,logId:s,quizId:C.quizId};g(t)};return o.useEffect(()=>{x&&z.success(w.message),d&&z.error(d.data.message)},[w,x,d]),e.jsx(I,{sx:{overflow:"auto"},children:e.jsx(W,{sx:{maxHeight:{md:530,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(M,{children:e.jsx(b,{children:we.map((c,s)=>e.jsx(r,{align:"center",sx:{width:c.width},children:c.label},s))})}),e.jsx(A,{children:l==null?void 0:l.map((c,s)=>{const t=i==null?void 0:i.find(h=>h.nis===c.nis);return e.jsxs(b,{children:[e.jsx(r,{align:"center",children:s+1}),e.jsx(r,{align:"center",children:c.nis}),e.jsx(r,{children:c.name}),e.jsx(r,{align:"center",children:c.class}),e.jsx(r,{align:"center",children:t?new Date(t.log_in).toLocaleDateString("id-ID",{hour:"numeric",minute:"numeric"}):"-"}),e.jsx(r,{align:"center",children:t?t.ip:"-"}),e.jsx(r,{align:"center",children:t?t.browser:"-"}),e.jsx(r,{align:"center",children:t?t!=null&&t.isActive?e.jsx(U,{sx:{color:"green",fontWeight:"bold"},children:"Ongoing"}):e.jsx(U,{sx:{color:"red",fontWeight:"bold"},children:"Finished"}):e.jsx(U,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"})}),e.jsxs(r,{align:"center",children:[e.jsx(K,{title:"Reset",children:e.jsx("span",{children:e.jsx(V,{color:"info",onClick:()=>u(c.nis,t==null?void 0:t.id),disabled:!t,children:v?e.jsx(Y,{size:20,color:"inherit"}):e.jsx(oe,{})})})}),e.jsx(K,{title:"Rejoin",children:e.jsx("span",{children:e.jsx(V,{color:"error",disabled:t?!t.isDone:!0,children:e.jsx(de,{})})})})]})]},s)})})]})})})},ye=[{label:"No",width:70},{label:"NIS",width:100},{label:"Nama",width:250},{label:"Kelas",width:50}],Se=({data:l,questions:i,quizname:C})=>{const[g,w]=o.useState(""),x=[...new Set(l==null?void 0:l.map(s=>s.class))],v=s=>s.class.toLowerCase().includes(g.toLocaleLowerCase()),d=l==null?void 0:l.filter(v),u=o.useRef(null),c=()=>{if(u.current){const s=B.book_new(),t=u.current,h=B.table_to_sheet(t);B.book_append_sheet(s,h,"Sheet1");const m=ee(s,{bookType:"xlsx",type:"array"}),a=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=`Analisis_${C}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(a,p);else{const f=document.createElement("a");f.href=window.URL.createObjectURL(a),f.download=p,f.click()}}};return e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(j,{variant:"contained",color:"primary",onClick:()=>w(""),children:"All"}),x==null?void 0:x.map(s=>e.jsx(j,{variant:"contained",color:"primary",onClick:()=>w(s),children:s},s)),e.jsx(j,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:c,children:"Export"})]}),e.jsx(I,{sx:{overflow:"auto",width:{md:850,lg:1080,xl:1300}},children:e.jsx(W,{sx:{maxHeight:{md:480,xl:570}},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:650},ref:u,children:[e.jsxs(M,{children:[e.jsxs(b,{children:[ye.map((s,t)=>e.jsx(r,{rowSpan:2,align:"center",sx:{minWidth:s.width},children:s.label},t)),i==null?void 0:i.filter(s=>s.type===1).map((s,t)=>e.jsx(r,{align:"center",sx:{minWidth:50},children:t+1},t)),e.jsx(r,{rowSpan:2,align:"center",children:"Correct"}),e.jsx(r,{rowSpan:2,align:"center",children:"Wrong"}),e.jsx(r,{rowSpan:2,align:"center",children:"Score"})]}),e.jsx(b,{children:i==null?void 0:i.filter(s=>s.type===1).map((s,t)=>e.jsx(r,{align:"center",sx:{minWidth:50},children:s.key},t))})]}),e.jsx(A,{children:d==null?void 0:d.map((s,t)=>e.jsxs(o.Fragment,{children:[e.jsxs(b,{children:[e.jsx(r,{align:"center",rowSpan:2,children:t+1}),e.jsx(r,{align:"center",rowSpan:2,children:s.nis}),e.jsx(r,{rowSpan:2,children:s.name}),e.jsx(r,{align:"center",rowSpan:2,children:s.class}),i==null?void 0:i.filter(h=>h.type===1).map((h,m)=>{const a=s.answers.find(p=>p.questionId===h.id);return e.jsx(r,{align:"center",children:a?a.mc:"-"},m)}),e.jsx(r,{align:"center",rowSpan:2,children:s.correct}),e.jsx(r,{align:"center",rowSpan:2,children:s.wrong}),e.jsx(r,{align:"center",rowSpan:2,children:s.mcPoin})]}),e.jsx(b,{children:i==null?void 0:i.filter(h=>h.type===1).map((h,m)=>{const a=s.answers.find(p=>p.questionId===h.id);return e.jsx(r,{align:"center",children:a?a.poin:"-"},m)})})]},t))})]})})})]})},X=l=>({__html:l}),ve=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"Score",width:30},{label:"Correction",width:30}],Ce=({data:l,questions:i})=>{var H,J;const C=O(),g=C.quizId,w=C.gradeId,[x,{data:v,isSuccess:d,isLoading:u,error:c}]=re(),[s,t]=o.useState(""),[h,m]=o.useState(""),[a,p]=o.useState(!1),[f,$]=o.useState({}),L=i==null?void 0:i.filter(n=>n.type===2),P=l==null?void 0:l.find(n=>n.nis===s),D=[...new Set(l==null?void 0:l.map(n=>n.class))],F=n=>n.class.toLowerCase().includes(h.toLocaleLowerCase()),_=l==null?void 0:l.filter(F),y=(J=(H=P==null?void 0:P.answers)==null?void 0:H.filter(n=>n.essay!==null))==null?void 0:J.map(n=>({nis:P.nis,questionId:n.questionId,essay:n.essay,poin:n.poin})),G=n=>{t(n),p(!0)},N=(n,S)=>{$(k=>({...k,[n]:S}))},Q=async n=>{n.preventDefault();const S=Object.entries(f).map(([k,R])=>({questionId:k,poin:parseInt(R)}));await Promise.all(S.map(({questionId:k,poin:R})=>{x({id:k,body:{poin:R,nis:P.nis,gradeId:w,quizId:g}})}))};return o.useEffect(()=>{d&&(z.success(v.message),p(!1),$({})),c&&z.error(c.data.message)},[v,d,c]),e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(j,{variant:"contained",color:"primary",onClick:()=>m(""),children:"All"}),D==null?void 0:D.map(n=>e.jsx(j,{variant:"contained",color:"primary",onClick:()=>m(n),children:n},n))]}),e.jsx(I,{sx:{overflow:"auto"},children:e.jsx(W,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(M,{children:e.jsx(b,{children:ve.map((n,S)=>e.jsx(r,{align:"center",sx:{width:n.width},children:n.label},S))})}),e.jsx(A,{children:_==null?void 0:_.map((n,S)=>e.jsxs(b,{children:[e.jsx(r,{align:"center",children:S+1}),e.jsx(r,{align:"center",children:n.nis}),e.jsx(r,{children:n.name}),e.jsx(r,{align:"center",children:n.class}),e.jsx(r,{align:"center",children:n.essayPoin}),e.jsx(r,{align:"center",children:e.jsx(j,{variant:"contained",color:"info",onClick:()=>G(n.nis),children:"score"})})]},S))})]})})}),e.jsx(ue,{open:a,onClose:()=>p(!1),closeAfterTransition:!0,children:e.jsx(me,{in:a,children:e.jsx(Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:350,md:600},maxHeight:600,overflow:"auto",bgcolor:"#ffff",boxShadow:24,p:1,borderRadius:"5px"},children:e.jsxs("form",{onSubmit:Q,children:[e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(b,{children:["Question","Answer","Score"].map(n=>e.jsx(r,{children:n},n))})}),e.jsx(A,{children:L==null?void 0:L.map(n=>{var S,k,R;return e.jsxs(b,{children:[e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:X(n.question)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:X((S=y==null?void 0:y.find(T=>T.questionId===n.id))==null?void 0:S.essay)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(se,{value:f[n.id]!==void 0?f[n.id]:((k=y==null?void 0:y.find(T=>T.questionId===n.id))==null?void 0:k.poin)!==void 0?(R=y==null?void 0:y.find(T=>T.questionId===n.id))==null?void 0:R.poin:0,onChange:T=>N(n.id,T.target.value)})})]},n.id)})})]}),e.jsx(j,{fullWidth:!0,variant:"contained",color:"success",type:"submit",children:u?e.jsx(Y,{size:20,color:"inherit"}):"Submit"}),e.jsx(j,{fullWidth:!0,variant:"contained",color:"error",onClick:()=>p(!1),sx:{mt:1},children:"close"})]})})})})]})},ke=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"MC",width:30},{label:"Essay",width:30},{label:"Score",width:30}],Ie=({data:l,quizname:i,questions:C})=>{const[g,w]=o.useState(""),x=[...new Set(l==null?void 0:l.map(s=>s.class))],v=s=>s.class.toLowerCase().includes(g.toLocaleLowerCase()),d=l==null?void 0:l.filter(v),u=o.useRef(null),c=()=>{if(u.current){const s=B.book_new(),t=u.current,h=B.table_to_sheet(t);B.book_append_sheet(s,h,"Sheet1");const m=ee(s,{bookType:"xlsx",type:"array"}),a=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=`Nilai_${i}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(a,p);else{const f=document.createElement("a");f.href=window.URL.createObjectURL(a),f.download=p,f.click()}}};return e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(j,{variant:"contained",color:"primary",onClick:()=>w(""),children:"All"}),x==null?void 0:x.map(s=>e.jsx(j,{variant:"contained",color:"primary",onClick:()=>w(s),children:s},s)),e.jsx(j,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:c,children:"Export"})]}),e.jsx(I,{sx:{overflow:"auto"},children:e.jsx(W,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",ref:u,children:[e.jsx(M,{children:e.jsx(b,{children:ke.map((s,t)=>e.jsx(r,{align:"center",sx:{width:s.width},children:s.label},t))})}),e.jsx(A,{children:d==null?void 0:d.map((s,t)=>e.jsxs(b,{children:[e.jsx(r,{align:"center",children:t+1}),e.jsx(r,{align:"center",children:s.nis}),e.jsx(r,{children:s.name}),e.jsx(r,{align:"center",children:s.class}),e.jsx(r,{align:"center",children:s.mcPoin}),e.jsx(r,{align:"center",children:s.essayPoin}),e.jsx(r,{align:"center",children:s.totalPoin})]},t))})]})})})]})},Le=()=>{const[l,i]=o.useState(!0),[C,g]=o.useState(!1),[w,x]=o.useState(!1),[v,d]=o.useState(!1),u=()=>{i(!0),d(!1),x(!1),g(!1)},c=()=>{i(!1),g(!0),d(!1),x(!1)},s=()=>{i(!1),g(!1),x(!0),d(!1)},t=()=>{i(!1),g(!1),x(!1),d(!0)},h=O(),m=h.quizname,a=h.quizId,p=h.gradeId,{data:f,refetch:$}=te(a,{skip:!a}),{data:L,refetch:P}=le({quizId:a,gradeId:p},{skip:!a&&!p}),{data:D,refetch:F}=ie(a,{skip:!a}),[_,y]=o.useState(""),G=H=>H.name.toLowerCase().includes(_.toLowerCase()),N=L==null?void 0:L.filter(G),Q=()=>{$(),P(),F()};return e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx(se,{placeholder:"Search Student",sx:{width:360},value:_,onChange:H=>y(H.target.value)}),e.jsxs(Z,{sx:{display:"flex",gap:1},children:[e.jsx(j,{sx:{width:170},variant:"contained",color:"error",startIcon:e.jsx(he,{}),onClick:Q,children:"update data"}),e.jsx(j,{startIcon:e.jsx(xe,{}),variant:"contained",color:"success",onClick:u,children:"Log"}),e.jsx(j,{startIcon:e.jsx(pe,{}),variant:"contained",color:"success",onClick:c,children:"mc"}),e.jsx(j,{startIcon:e.jsx(je,{}),variant:"contained",color:"success",onClick:s,children:"essay"}),e.jsx(j,{startIcon:e.jsx(fe,{}),variant:"contained",color:"success",onClick:t,children:"scores"})]})]}),l&&e.jsx(be,{data:N,logs:D}),C&&e.jsx(Se,{data:N,questions:f,quizname:m}),w&&e.jsx(Ce,{data:N,questions:f}),v&&e.jsx(Ie,{data:N,quizname:m,questions:f})]})},is=()=>e.jsxs(ce,{children:[e.jsx(ae,{title:"quiz Name"}),e.jsx(ge,{container:!0,sx:{minHeight:"85vh",display:"flex",flexDirection:"column",gap:1},children:e.jsx(Le,{})})]});export{is as default};
