import{R as J,aj as ne,ak as re,r as h,B,j as e,C as O,al as te,c as Z,a6 as ae,am as ie,an as le}from"./index-DjgEXlBM.js";import{P as ce}from"./PageName-ZPCS438x.js";import{L as oe}from"./Layout-BRQ_XQ2b.js";import{d as de,a as he,b as q,c as xe,e as je,f as pe,g as fe,h as ue}from"./CloudDownloadOutlined-ZzvV9EcU.js";import{P}from"./Paper-0_Nxrl9K.js";import{T as F}from"./TableContainer-ywpNEKl8.js";import{a as z,b as M,c as y,T as n}from"./TableRow-9p40iQCm.js";import{T as W}from"./TableBody-Dl-9RlEw.js";import{T as $}from"./Typography-Ck8ZmvYm.js";import{T as V}from"./Tooltip-Ch4PvUVU.js";import{I as X}from"./IconButton-DVAIich5.js";import{u as D,w as ee}from"./xlsx-DT8pmw08.js";import{B as u}from"./Button-FzYR9QjW.js";import{M as me,F as ge}from"./Modal-DCAalMQR.js";import{I as se}from"./Input-Djdk2BZh.js";import{G as we}from"./Grid-Cm2mtght.js";import"./ChevronRight-JRIqjZRu.js";import"./createSvgIcon-DbdgCAn1.js";import"./GlobalStyles-naRZnfmu.js";import"./listItemIconClasses-8sYbMhEm.js";import"./useTheme-BUXj7LXp.js";import"./ListItemText-sHcdjvhz.js";import"./PeopleAlt-DJyQ-vYi.js";import"./CalendarMonth-ZeFlFCc4.js";import"./Style-COl1V7Ra.js";import"./Popper-ibqJkCiK.js";import"./Grow-C7cMHxnE.js";import"./utils-CGVmn-r6.js";const be=[{label:"No",width:30},{label:"NIS",width:100},{label:"Name",width:150},{label:"Class",width:30},{label:"Join",width:110},{label:"IP",width:110},{label:"Browser",width:110},{label:"Status",width:100},{label:"Reset",width:100}],ye=({data:i,logs:c})=>{const S=J(),[g,{data:w,isSuccess:m,isLoading:b,error:x}]=ne(),[v,{data:l,isSuccess:r,error:d,isLoading:j}]=re(),f=(a,p)=>{const t={nis:parseInt(a),logId:parseInt(p),quizId:parseInt(S.quizId)};g(t)},o=(a,p)=>{const t={nis:parseInt(a),logId:parseInt(p),quizId:parseInt(S.quizId)};v(t)};return h.useEffect(()=>{m&&B.success(w.message),x&&B.error(x.data.message)},[w,m,x]),h.useEffect(()=>{r&&B.success(l.message),d&&B.error(d.data.message)},[l,r,d]),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:530,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(M,{children:e.jsx(y,{children:be.map((a,p)=>e.jsx(n,{align:"center",sx:{width:a.width},children:a.label},p))})}),e.jsx(W,{children:i==null?void 0:i.map((a,p)=>{const t=c==null?void 0:c.find(I=>I.nis===a.nis);return e.jsxs(y,{children:[e.jsx(n,{align:"center",children:p+1}),e.jsx(n,{align:"center",children:a.nis}),e.jsx(n,{children:a.name}),e.jsx(n,{align:"center",children:a.class}),e.jsx(n,{align:"center",children:t?new Date(t.log_in).toLocaleDateString("id-ID",{hour:"numeric",minute:"numeric"}):"-"}),e.jsx(n,{align:"center",children:t?t.ip:"-"}),e.jsx(n,{align:"center",children:t?t.browser:"-"}),e.jsx(n,{align:"center",children:t?t!=null&&t.isDone?e.jsx($,{sx:{color:"red",fontWeight:"bold"},children:"Finished"}):t!=null&&t.isActive?e.jsx($,{sx:{color:"green",fontWeight:"bold"},children:"Ongoing"}):e.jsx($,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"}):e.jsx($,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"})}),e.jsxs(n,{align:"center",children:[e.jsx(V,{title:"Reset",children:e.jsx("span",{children:e.jsx(X,{color:"info",onClick:()=>f(a.nis,t==null?void 0:t.id),disabled:t?!(t!=null&&t.isActive):!0,children:b?e.jsx(O,{size:20,color:"inherit"}):e.jsx(de,{})})})}),e.jsx(V,{title:"Rejoin",children:e.jsx("span",{children:e.jsx(X,{color:"error",disabled:t?!t.isDone:!0,onClick:()=>o(a.nis,t==null?void 0:t.id),children:j?e.jsx(O,{size:20,color:"inherit"}):e.jsx(he,{})})})})]})]},p)})})]})})})},Se=[{label:"No",width:70},{label:"NIS",width:100},{label:"Nama",width:250},{label:"Kelas",width:50}],ve=({data:i,questions:c,quizname:S})=>{const[g,w]=h.useState(""),m=[...new Set(i==null?void 0:i.map(r=>r.class))],b=r=>r.class.toLowerCase().includes(g.toLocaleLowerCase()),x=i==null?void 0:i.filter(b),v=h.useRef(null),l=()=>{if(v.current){const r=D.book_new(),d=v.current,j=D.table_to_sheet(d);D.book_append_sheet(r,j,"Sheet1");const f=ee(r,{bookType:"xlsx",type:"array"}),o=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=`Analisis_${S}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(o,a);else{const p=document.createElement("a");p.href=window.URL.createObjectURL(o),p.download=a,p.click()}}};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>w(""),children:"All"}),m==null?void 0:m.map(r=>e.jsx(u,{variant:"contained",color:"primary",onClick:()=>w(r),children:r},r)),e.jsx(u,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:l,children:"Export"})]}),e.jsx(P,{sx:{overflowX:"auto",overflowY:"auto",width:{md:900,lg:1220,xl:1400}},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:650},ref:v,children:[e.jsxs(M,{children:[e.jsxs(y,{children:[Se.map((r,d)=>e.jsx(n,{rowSpan:2,align:"center",sx:{minWidth:r.width},children:r.label},d)),c==null?void 0:c.filter(r=>r.type===1).map((r,d)=>e.jsx(n,{align:"center",sx:{minWidth:50},children:d+1},d)),e.jsx(n,{rowSpan:2,align:"center",children:"Correct"}),e.jsx(n,{rowSpan:2,align:"center",children:"Wrong"}),e.jsx(n,{rowSpan:2,align:"center",children:"Score"})]}),e.jsx(y,{children:c==null?void 0:c.filter(r=>r.type===1).map((r,d)=>e.jsx(n,{align:"center",sx:{minWidth:50},children:r.key},d))})]}),e.jsx(W,{children:x==null?void 0:x.map((r,d)=>e.jsxs(h.Fragment,{children:[e.jsxs(y,{children:[e.jsx(n,{align:"center",rowSpan:2,children:d+1}),e.jsx(n,{align:"center",rowSpan:2,children:r.nis}),e.jsx(n,{rowSpan:2,children:r.name}),e.jsx(n,{align:"center",rowSpan:2,children:r.class}),c==null?void 0:c.filter(j=>j.type===1).map((j,f)=>{const o=r.answers.find(a=>a.questionId===j.id);return e.jsx(n,{align:"center",children:o?o.mc:"-"},f)}),e.jsx(n,{align:"center",rowSpan:2,children:r.correct}),e.jsx(n,{align:"center",rowSpan:2,children:r.wrong}),e.jsx(n,{align:"center",rowSpan:2,children:r.mcPoin})]}),e.jsx(y,{children:c==null?void 0:c.filter(j=>j.type===1).map((j,f)=>{const o=r.answers.find(a=>a.questionId===j.id);return e.jsx(n,{align:"center",children:o?o.poin:"-"},f)})})]},d))})]})})})]})},Y=i=>({__html:i}),Ce=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"Score",width:30},{label:"Correction",width:30}],ke=({data:i,questions:c})=>{var R,K;const S=J(),g=S.quizId,w=S.gradeId,[m,{data:b,isSuccess:x,isLoading:v,error:l}]=te(),[r,d]=h.useState(""),[j,f]=h.useState(""),[o,a]=h.useState(!1),[p,t]=h.useState({}),I=c==null?void 0:c.filter(s=>s.type===2),_=i==null?void 0:i.find(s=>s.nis===r),E=[...new Set(i==null?void 0:i.map(s=>s.class))],G=s=>s.class.toLowerCase().includes(j.toLocaleLowerCase()),N=i==null?void 0:i.filter(G),C=(K=(R=_==null?void 0:_.answers)==null?void 0:R.filter(s=>s.essay!==null))==null?void 0:K.map(s=>({nis:_.nis,questionId:s.questionId,essay:s.essay,poin:s.poin})),Q=s=>{d(s),a(!0)},H=(s,k)=>{t(L=>({...L,[s]:k}))},U=async s=>{s.preventDefault();const k=Object.entries(p).map(([L,A])=>({questionId:L,poin:parseInt(A)}));await Promise.all(k.map(({questionId:L,poin:A})=>{m({id:L,body:{poin:A,nis:_.nis,gradeId:w,quizId:g}})}))};return h.useEffect(()=>{x&&(B.success(b.message),a(!1),t({})),l&&B.error(l.data.message)},[b,x,l]),e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>f(""),children:"All"}),E==null?void 0:E.map(s=>e.jsx(u,{variant:"contained",color:"primary",onClick:()=>f(s),children:s},s))]}),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(M,{children:e.jsx(y,{children:Ce.map((s,k)=>e.jsx(n,{align:"center",sx:{width:s.width},children:s.label},k))})}),e.jsx(W,{children:N==null?void 0:N.map((s,k)=>e.jsxs(y,{children:[e.jsx(n,{align:"center",children:k+1}),e.jsx(n,{align:"center",children:s.nis}),e.jsx(n,{children:s.name}),e.jsx(n,{align:"center",children:s.class}),e.jsx(n,{align:"center",children:s.essayPoin}),e.jsx(n,{align:"center",children:e.jsx(u,{variant:"contained",color:"info",onClick:()=>Q(s.nis),children:"score"})})]},k))})]})})}),e.jsx(me,{open:o,onClose:()=>a(!1),closeAfterTransition:!0,children:e.jsx(ge,{in:o,children:e.jsx(Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:350,md:800},maxHeight:600,overflow:"auto",bgcolor:"#ffff",boxShadow:24,p:1,borderRadius:"5px"},children:e.jsxs("form",{onSubmit:U,children:[e.jsxs(z,{children:[e.jsx(M,{children:e.jsx(y,{children:["Question","Answer","Score"].map(s=>e.jsx(n,{children:s},s))})}),e.jsx(W,{children:I==null?void 0:I.map(s=>{var k,L,A;return e.jsxs(y,{children:[e.jsx(n,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:Y(s.question)})}),e.jsx(n,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:Y((k=C==null?void 0:C.find(T=>T.questionId===s.id))==null?void 0:k.essay)})}),e.jsx(n,{sx:{verticalAlign:"top"},children:e.jsx(se,{value:p[s.id]!==void 0?p[s.id]:((L=C==null?void 0:C.find(T=>T.questionId===s.id))==null?void 0:L.poin)!==void 0?(A=C==null?void 0:C.find(T=>T.questionId===s.id))==null?void 0:A.poin:0,onChange:T=>H(s.id,T.target.value)})})]},s.id)})})]}),e.jsx(u,{fullWidth:!0,variant:"contained",color:"success",type:"submit",children:v?e.jsx(O,{size:20,color:"inherit"}):"Submit"}),e.jsx(u,{fullWidth:!0,variant:"contained",color:"error",onClick:()=>a(!1),sx:{mt:1},children:"close"})]})})})})]})},Ie=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"MC",width:30},{label:"Essay",width:30},{label:"Score",width:30}],Le=({data:i,quizname:c})=>{const[S,g]=h.useState(""),w=[...new Set(i==null?void 0:i.map(l=>l.class))],m=l=>l.class.toLowerCase().includes(S.toLocaleLowerCase()),b=i==null?void 0:i.filter(m),x=h.useRef(null),v=()=>{if(x.current){const l=D.book_new(),r=x.current,d=D.table_to_sheet(r);D.book_append_sheet(l,d,"Sheet1");const j=ee(l,{bookType:"xlsx",type:"array"}),f=new Blob([j],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=`Nilai_${c}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(f,o);else{const a=document.createElement("a");a.href=window.URL.createObjectURL(f),a.download=o,a.click()}}};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>g(""),children:"All"}),w==null?void 0:w.map(l=>e.jsx(u,{variant:"contained",color:"primary",onClick:()=>g(l),children:l},l)),e.jsx(u,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:v,children:"Export"})]}),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",ref:x,children:[e.jsx(M,{children:e.jsx(y,{children:Ie.map((l,r)=>e.jsx(n,{align:"center",sx:{width:l.width},children:l.label},r))})}),e.jsx(W,{children:b==null?void 0:b.map((l,r)=>e.jsxs(y,{children:[e.jsx(n,{align:"center",children:r+1}),e.jsx(n,{align:"center",children:l.nis}),e.jsx(n,{children:l.name}),e.jsx(n,{align:"center",children:l.class}),e.jsx(n,{align:"center",children:l.mcPoin}),e.jsx(n,{align:"center",children:l.essayPoin}),e.jsx(n,{align:"center",children:l.totalPoin})]},r))})]})})})]})},Pe=()=>{const[i,c]=h.useState(!0),[S,g]=h.useState(!1),[w,m]=h.useState(!1),[b,x]=h.useState(!1),v=()=>{c(!0),x(!1),m(!1),g(!1)},l=()=>{c(!1),g(!0),x(!1),m(!1)},r=()=>{c(!1),g(!1),m(!0),x(!1)},d=()=>{c(!1),g(!1),m(!1),x(!0)},j=J(),f=j.quizname,o=j.quizId,a=j.gradeId,{data:p,refetch:t}=ae(o,{skip:!o}),{data:I,refetch:_}=ie({quizId:o,gradeId:a},{skip:!o&&!a}),{data:E,refetch:G}=le(o,{skip:!o}),[N,C]=h.useState(""),Q=R=>R.name.toLowerCase().includes(N.toLowerCase()),H=I==null?void 0:I.filter(Q),U=()=>{t(),_(),G()};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx(se,{placeholder:"Search Student",sx:{width:360},value:N,onChange:R=>C(R.target.value)}),e.jsxs(Z,{sx:{display:"flex",gap:1},children:[e.jsx(u,{sx:{width:170},variant:"contained",color:"error",startIcon:e.jsx(xe,{}),onClick:U,children:"update data"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(je,{}),variant:"contained",color:"success",onClick:v,children:"Log"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(pe,{}),variant:"contained",color:"success",onClick:l,children:"mc"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(fe,{}),variant:"contained",color:"success",onClick:r,children:"essay"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(ue,{}),variant:"contained",color:"success",onClick:d,children:"scores"})]})]}),i&&e.jsx(ye,{data:H,logs:E}),S&&e.jsx(ve,{data:H,questions:p,quizname:f}),w&&e.jsx(ke,{data:H,questions:p}),b&&e.jsx(Le,{data:H,quizname:f})]})},rs=()=>e.jsxs(oe,{children:[e.jsx(ce,{title:"quiz Name"}),e.jsx(we,{container:!0,sx:{minHeight:"85vh",display:"flex",flexDirection:"column",gap:1},children:e.jsx(Pe,{})})]});export{rs as default};
