import{J,aa as ne,ab as re,r as h,B,j as e,C as O,ac as te,c as Z,Z as ie,ad as ae,ae as le}from"./index-DVVZMFAy.js";import{P as ce}from"./PageName-CVqv3dsE.js";import{L as oe}from"./Layout-D97RgaFn.js";import{d as de,a as he,b as q,c as xe,e as pe,f as je,g as fe,h as ue}from"./CloudDownloadOutlined-yUkDdulI.js";import{P}from"./Paper-CojZdgXz.js";import{T as F}from"./TableContainer-NtLmG29M.js";import{T as z,a as M,b as y,c as n}from"./TableRow-3lfkq1cl.js";import{T as W}from"./TableBody-CwUpeEIY.js";import{T as $}from"./Typography-CI31gJNE.js";import{T as V}from"./Tooltip-DQTqAJg3.js";import{I as X}from"./IconButton-D0bPhnJn.js";import{u as D,w as ee}from"./xlsx-DT8pmw08.js";import{B as u}from"./Button-CYCXCPze.js";import{M as me,F as ge}from"./Modal-Cpz68z0j.js";import{I as se}from"./Input-DKQUFpGi.js";import{G as we}from"./Grid-Byh82s5p.js";import"./getThemeProps-D_yIhtQB.js";import"./createSvgIcon-BBYY8FNJ.js";import"./GlobalStyles-D9JB72R9.js";import"./listItemIconClasses-CWPOSp7D.js";import"./useTheme-CmsqvUfX.js";import"./ExitToApp-CrF1bS-w.js";import"./ChevronRight-CoZk7gnx.js";import"./PeopleAlt-odce-XfD.js";import"./CalendarMonth-D2YtUPcA.js";import"./Style-DpYiakdT.js";import"./Toolbar-DSj10l_W.js";import"./Popper-ymTHMGwe.js";import"./Grow-BLVuUMNW.js";import"./utils-DWTovDIY.js";const be=[{label:"No",width:30},{label:"NIS",width:100},{label:"Name",width:150},{label:"Class",width:30},{label:"Join",width:110},{label:"IP",width:110},{label:"Browser",width:110},{label:"Status",width:100},{label:"Reset",width:100}],ye=({data:a,logs:c})=>{const S=J(),[g,{data:w,isSuccess:m,isLoading:b,error:x}]=ne(),[v,{data:l,isSuccess:r,error:d,isLoading:p}]=re(),f=(i,j)=>{const t={nis:parseInt(i),logId:parseInt(j),quizId:parseInt(S.quizId)};g(t)},o=(i,j)=>{const t={nis:parseInt(i),logId:parseInt(j),quizId:parseInt(S.quizId)};v(t)};return h.useEffect(()=>{m&&B.success(w.message),x&&B.error(x.data.message)},[w,m,x]),h.useEffect(()=>{r&&B.success(l.message),d&&B.error(d.data.message)},[l,r,d]),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:530,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(M,{children:e.jsx(y,{children:be.map((i,j)=>e.jsx(n,{align:"center",sx:{width:i.width},children:i.label},j))})}),e.jsx(W,{children:a==null?void 0:a.map((i,j)=>{const t=c==null?void 0:c.find(k=>k.nis===i.nis);return e.jsxs(y,{children:[e.jsx(n,{align:"center",children:j+1}),e.jsx(n,{align:"center",children:i.nis}),e.jsx(n,{children:i.name}),e.jsx(n,{align:"center",children:i.class}),e.jsx(n,{align:"center",children:t?new Date(t.log_in).toLocaleDateString("id-ID",{hour:"numeric",minute:"numeric"}):"-"}),e.jsx(n,{align:"center",children:t?t.ip:"-"}),e.jsx(n,{align:"center",children:t?t.browser:"-"}),e.jsx(n,{align:"center",children:t?t!=null&&t.isDone?e.jsx($,{sx:{color:"red",fontWeight:"bold"},children:"Finished"}):t!=null&&t.isActive?e.jsx($,{sx:{color:"green",fontWeight:"bold"},children:"Ongoing"}):e.jsx($,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"}):e.jsx($,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"})}),e.jsxs(n,{align:"center",children:[e.jsx(V,{title:"Reset",children:e.jsx("span",{children:e.jsx(X,{color:"info",onClick:()=>f(i.nis,t==null?void 0:t.id),disabled:t?!(t!=null&&t.isActive):!0,children:b?e.jsx(O,{size:20,color:"inherit"}):e.jsx(de,{})})})}),e.jsx(V,{title:"Rejoin",children:e.jsx("span",{children:e.jsx(X,{color:"error",disabled:t?!t.isDone:!0,onClick:()=>o(i.nis,t==null?void 0:t.id),children:p?e.jsx(O,{size:20,color:"inherit"}):e.jsx(he,{})})})})]})]},j)})})]})})})},Se=[{label:"No",width:70},{label:"NIS",width:100},{label:"Nama",width:250},{label:"Kelas",width:50}],ve=({data:a,questions:c,quizname:S})=>{const[g,w]=h.useState(""),m=[...new Set(a==null?void 0:a.map(r=>r.class))],b=r=>r.class.toLowerCase().includes(g.toLocaleLowerCase()),x=a==null?void 0:a.filter(b),v=h.useRef(null),l=()=>{if(v.current){const r=D.book_new(),d=v.current,p=D.table_to_sheet(d);D.book_append_sheet(r,p,"Sheet1");const f=ee(r,{bookType:"xlsx",type:"array"}),o=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=`Analisis_${S}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(o,i);else{const j=document.createElement("a");j.href=window.URL.createObjectURL(o),j.download=i,j.click()}}};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>w(""),children:"All"}),m==null?void 0:m.map(r=>e.jsx(u,{variant:"contained",color:"primary",onClick:()=>w(r),children:r},r)),e.jsx(u,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:l,children:"Export"})]}),e.jsx(P,{sx:{overflowX:"auto",overflowY:"auto",width:{md:900,lg:1220,xl:1400}},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:650},ref:v,children:[e.jsxs(M,{children:[e.jsxs(y,{children:[Se.map((r,d)=>e.jsx(n,{rowSpan:2,align:"center",sx:{minWidth:r.width},children:r.label},d)),c==null?void 0:c.filter(r=>r.type===1).map((r,d)=>e.jsx(n,{align:"center",sx:{minWidth:50},children:d+1},d)),e.jsx(n,{rowSpan:2,align:"center",children:"Correct"}),e.jsx(n,{rowSpan:2,align:"center",children:"Wrong"}),e.jsx(n,{rowSpan:2,align:"center",children:"Score"})]}),e.jsx(y,{children:c==null?void 0:c.filter(r=>r.type===1).map((r,d)=>e.jsx(n,{align:"center",sx:{minWidth:50},children:r.key},d))})]}),e.jsx(W,{children:x==null?void 0:x.map((r,d)=>e.jsxs(h.Fragment,{children:[e.jsxs(y,{children:[e.jsx(n,{align:"center",rowSpan:2,children:d+1}),e.jsx(n,{align:"center",rowSpan:2,children:r.nis}),e.jsx(n,{rowSpan:2,children:r.name}),e.jsx(n,{align:"center",rowSpan:2,children:r.class}),c==null?void 0:c.filter(p=>p.type===1).map((p,f)=>{const o=r.answers.find(i=>i.questionId===p.id);return e.jsx(n,{align:"center",children:o?o.mc:"-"},f)}),e.jsx(n,{align:"center",rowSpan:2,children:r.correct}),e.jsx(n,{align:"center",rowSpan:2,children:r.wrong}),e.jsx(n,{align:"center",rowSpan:2,children:r.mcPoin})]}),e.jsx(y,{children:c==null?void 0:c.filter(p=>p.type===1).map((p,f)=>{const o=r.answers.find(i=>i.questionId===p.id);return e.jsx(n,{align:"center",children:o?o.poin:"-"},f)})})]},d))})]})})})]})},Y=a=>({__html:a}),Ce=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"Score",width:30},{label:"Correction",width:30}],Ie=({data:a,questions:c})=>{var R,K;const S=J(),g=S.quizId,w=S.gradeId,[m,{data:b,isSuccess:x,isLoading:v,error:l}]=te(),[r,d]=h.useState(""),[p,f]=h.useState(""),[o,i]=h.useState(!1),[j,t]=h.useState({}),k=c==null?void 0:c.filter(s=>s.type===2),_=a==null?void 0:a.find(s=>s.nis===r),E=[...new Set(a==null?void 0:a.map(s=>s.class))],G=s=>s.class.toLowerCase().includes(p.toLocaleLowerCase()),N=a==null?void 0:a.filter(G),C=(K=(R=_==null?void 0:_.answers)==null?void 0:R.filter(s=>s.essay!==null))==null?void 0:K.map(s=>({nis:_.nis,questionId:s.questionId,essay:s.essay,poin:s.poin})),Q=s=>{d(s),i(!0)},H=(s,I)=>{t(L=>({...L,[s]:I}))},U=async s=>{s.preventDefault();const I=Object.entries(j).map(([L,A])=>({questionId:L,poin:parseInt(A)}));await Promise.all(I.map(({questionId:L,poin:A})=>{m({id:L,body:{poin:A,nis:_.nis,gradeId:w,quizId:g}})}))};return h.useEffect(()=>{x&&(B.success(b.message),i(!1),t({})),l&&B.error(l.data.message)},[b,x,l]),e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>f(""),children:"All"}),E==null?void 0:E.map(s=>e.jsx(u,{variant:"contained",color:"primary",onClick:()=>f(s),children:s},s))]}),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(M,{children:e.jsx(y,{children:Ce.map((s,I)=>e.jsx(n,{align:"center",sx:{width:s.width},children:s.label},I))})}),e.jsx(W,{children:N==null?void 0:N.map((s,I)=>e.jsxs(y,{children:[e.jsx(n,{align:"center",children:I+1}),e.jsx(n,{align:"center",children:s.nis}),e.jsx(n,{children:s.name}),e.jsx(n,{align:"center",children:s.class}),e.jsx(n,{align:"center",children:s.essayPoin}),e.jsx(n,{align:"center",children:e.jsx(u,{variant:"contained",color:"info",onClick:()=>Q(s.nis),children:"score"})})]},I))})]})})}),e.jsx(me,{open:o,onClose:()=>i(!1),closeAfterTransition:!0,children:e.jsx(ge,{in:o,children:e.jsx(Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:350,md:800},maxHeight:600,overflow:"auto",bgcolor:"#ffff",boxShadow:24,p:1,borderRadius:"5px"},children:e.jsxs("form",{onSubmit:U,children:[e.jsxs(z,{children:[e.jsx(M,{children:e.jsx(y,{children:["Question","Answer","Score"].map(s=>e.jsx(n,{children:s},s))})}),e.jsx(W,{children:k==null?void 0:k.map(s=>{var I,L,A;return e.jsxs(y,{children:[e.jsx(n,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:Y(s.question)})}),e.jsx(n,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:Y((I=C==null?void 0:C.find(T=>T.questionId===s.id))==null?void 0:I.essay)})}),e.jsx(n,{sx:{verticalAlign:"top"},children:e.jsx(se,{value:j[s.id]!==void 0?j[s.id]:((L=C==null?void 0:C.find(T=>T.questionId===s.id))==null?void 0:L.poin)!==void 0?(A=C==null?void 0:C.find(T=>T.questionId===s.id))==null?void 0:A.poin:0,onChange:T=>H(s.id,T.target.value)})})]},s.id)})})]}),e.jsx(u,{fullWidth:!0,variant:"contained",color:"success",type:"submit",children:v?e.jsx(O,{size:20,color:"inherit"}):"Submit"}),e.jsx(u,{fullWidth:!0,variant:"contained",color:"error",onClick:()=>i(!1),sx:{mt:1},children:"close"})]})})})})]})},ke=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"MC",width:30},{label:"Essay",width:30},{label:"Score",width:30}],Le=({data:a,quizname:c})=>{const[S,g]=h.useState(""),w=[...new Set(a==null?void 0:a.map(l=>l.class))],m=l=>l.class.toLowerCase().includes(S.toLocaleLowerCase()),b=a==null?void 0:a.filter(m),x=h.useRef(null),v=()=>{if(x.current){const l=D.book_new(),r=x.current,d=D.table_to_sheet(r);D.book_append_sheet(l,d,"Sheet1");const p=ee(l,{bookType:"xlsx",type:"array"}),f=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=`Nilai_${c}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(f,o);else{const i=document.createElement("a");i.href=window.URL.createObjectURL(f),i.download=o,i.click()}}};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>g(""),children:"All"}),w==null?void 0:w.map(l=>e.jsx(u,{variant:"contained",color:"primary",onClick:()=>g(l),children:l},l)),e.jsx(u,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:v,children:"Export"})]}),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",ref:x,children:[e.jsx(M,{children:e.jsx(y,{children:ke.map((l,r)=>e.jsx(n,{align:"center",sx:{width:l.width},children:l.label},r))})}),e.jsx(W,{children:b==null?void 0:b.map((l,r)=>e.jsxs(y,{children:[e.jsx(n,{align:"center",children:r+1}),e.jsx(n,{align:"center",children:l.nis}),e.jsx(n,{children:l.name}),e.jsx(n,{align:"center",children:l.class}),e.jsx(n,{align:"center",children:l.mcPoin}),e.jsx(n,{align:"center",children:l.essayPoin}),e.jsx(n,{align:"center",children:l.totalPoin})]},r))})]})})})]})},Pe=()=>{const[a,c]=h.useState(!0),[S,g]=h.useState(!1),[w,m]=h.useState(!1),[b,x]=h.useState(!1),v=()=>{c(!0),x(!1),m(!1),g(!1)},l=()=>{c(!1),g(!0),x(!1),m(!1)},r=()=>{c(!1),g(!1),m(!0),x(!1)},d=()=>{c(!1),g(!1),m(!1),x(!0)},p=J(),f=p.quizname,o=p.quizId,i=p.gradeId,{data:j,refetch:t}=ie(o,{skip:!o}),{data:k,refetch:_}=ae({quizId:o,gradeId:i},{skip:!o&&!i}),{data:E,refetch:G}=le(o,{skip:!o}),[N,C]=h.useState(""),Q=R=>R.name.toLowerCase().includes(N.toLowerCase()),H=k==null?void 0:k.filter(Q),U=()=>{t(),_(),G()};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx(se,{placeholder:"Search Student",sx:{width:360},value:N,onChange:R=>C(R.target.value)}),e.jsxs(Z,{sx:{display:"flex",gap:1},children:[e.jsx(u,{sx:{width:170},variant:"contained",color:"error",startIcon:e.jsx(xe,{}),onClick:U,children:"update data"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(pe,{}),variant:"contained",color:"success",onClick:v,children:"Log"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(je,{}),variant:"contained",color:"success",onClick:l,children:"mc"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(fe,{}),variant:"contained",color:"success",onClick:r,children:"essay"}),e.jsx(u,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(ue,{}),variant:"contained",color:"success",onClick:d,children:"scores"})]})]}),a&&e.jsx(ye,{data:H,logs:E}),S&&e.jsx(ve,{data:H,questions:j,quizname:f}),w&&e.jsx(Ie,{data:H,questions:j}),b&&e.jsx(Le,{data:H,quizname:f})]})},is=()=>e.jsxs(oe,{children:[e.jsx(ce,{title:"quiz Name"}),e.jsx(we,{container:!0,sx:{minHeight:"85vh",display:"flex",flexDirection:"column",gap:1},children:e.jsx(Pe,{})})]});export{is as default};
