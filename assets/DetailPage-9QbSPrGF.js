import{M as O,af as ne,ag as re,r as h,B as R,j as e,C as K,ah as ae,c as Z,a1 as ie,ai as te,aj as le}from"./index-Pi4NK-hc.js";import{P as ce}from"./PageName-sACGNQci.js";import{L as oe}from"./Layout-BzCYq1Np.js";import{d as de,a as he,b as q,c as xe,e as pe,f as je,g as fe,h as ue}from"./CloudDownloadOutlined-CBMxnlcV.js";import{P}from"./Paper-Ds0x8VKA.js";import{T as F}from"./TableContainer-Dl90U6rU.js";import{T as z,a as y,b as r,c as M}from"./TableRow-CjK6bnuW.js";import{T as $}from"./TableHead-QSBjqVUO.js";import{T as W}from"./Typography-ChcBQgh6.js";import{T as V}from"./Tooltip-DiS6NDTV.js";import{I as X}from"./IconButton-DQIdw11I.js";import{u as A,w as ee}from"./xlsx-DT8pmw08.js";import{B as f}from"./Button-BhILrLq4.js";import{M as me,F as ge}from"./Modal-aB4DLG-a.js";import{I as se}from"./Input-CM8kKTSM.js";import{G as we}from"./Grid-jzXX0r0e.js";import"./FolderCopy-C5iLP6mR.js";import"./getThemeProps-C9w7lDtp.js";import"./createSvgIcon-BYOduQ-c.js";import"./GlobalStyles-D4NvMpo5.js";import"./listItemIconClasses-BjYFQR0m.js";import"./useTheme-DKJ__Eh-.js";import"./ChevronRight-CH_0xZhb.js";import"./PeopleAlt-DRfyY0WF.js";import"./CalendarMonth-DbemkXPV.js";import"./Style-Cqh2H65G.js";import"./colorManipulator-DR6Lge86.js";import"./ExitToApp-wCZAPOmX.js";import"./Toolbar-BflR_3Nr.js";import"./Popper-BZQ7Y6yv.js";import"./Grow-Dvz_L04G.js";import"./utils-Cboa8wdK.js";const be=[{label:"No",width:30},{label:"NIS",width:100},{label:"Nama",width:150},{label:"Kelas",width:30},{label:"Masuk",width:110},{label:"IP",width:110},{label:"Browser",width:110},{label:"Status",width:100},{label:"Reset",width:100}],ye=({data:i,logs:l})=>{const v=O(),[g,{data:w,isSuccess:j,isLoading:I,error:x}]=ne(),[m,{data:b,isSuccess:s,error:c,isLoading:p}]=re(),u=(t,o)=>{const a={nis:parseInt(t),logId:parseInt(o),quizId:parseInt(v.quizId)};g(a)},d=(t,o)=>{const a={nis:parseInt(t),logId:parseInt(o),quizId:parseInt(v.quizId)};m(a)};return h.useEffect(()=>{j&&R.success(w.message),x&&R.error(x.data.message)},[w,j,x]),h.useEffect(()=>{s&&R.success(b.message),c&&R.error(c.data.message)},[b,s,c]),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:530,lg:550,xl:700},width:"100%"},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx($,{children:e.jsx(y,{children:be.map((t,o)=>e.jsx(r,{align:"center",sx:{width:t.width},children:t.label},o))})}),e.jsx(M,{children:i==null?void 0:i.map((t,o)=>{const a=l==null?void 0:l.find(C=>C.nis===t.nis);return e.jsxs(y,{children:[e.jsx(r,{align:"center",children:o+1}),e.jsx(r,{align:"center",children:t.nis}),e.jsx(r,{children:t.name}),e.jsx(r,{align:"center",children:t.class}),e.jsx(r,{align:"center",children:a?new Date(a.log_in).toLocaleDateString("id-ID",{hour:"numeric",minute:"numeric"}):"-"}),e.jsx(r,{align:"center",children:a?a.ip:"-"}),e.jsx(r,{align:"center",children:a?a.browser:"-"}),e.jsx(r,{align:"center",children:a?a!=null&&a.isDone?e.jsx(W,{sx:{color:"red",fontWeight:"bold"},children:"Finished"}):a!=null&&a.isActive?e.jsx(W,{sx:{color:"green",fontWeight:"bold"},children:"Ongoing"}):e.jsx(W,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"}):e.jsx(W,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"})}),e.jsxs(r,{align:"center",children:[e.jsx(V,{title:"Reset",children:e.jsx("span",{children:e.jsx(X,{color:"info",onClick:()=>u(t.nis,a==null?void 0:a.id),disabled:a?!(a!=null&&a.isActive):!0,children:I?e.jsx(K,{size:20,color:"inherit"}):e.jsx(de,{})})})}),e.jsx(V,{title:"Rejoin",children:e.jsx("span",{children:e.jsx(X,{color:"error",disabled:a?!a.isDone:!0,onClick:()=>d(t.nis,a==null?void 0:a.id),children:p?e.jsx(K,{size:20,color:"inherit"}):e.jsx(he,{})})})})]})]},o)})})]})})})},Se=[{label:"No",width:70},{label:"NIS",width:100},{label:"Nama",width:250},{label:"Kelas",width:50}],ke=({data:i,questions:l,quizname:v})=>{const[g,w]=h.useState(""),j=[...new Set(i==null?void 0:i.map(s=>s.class))],I=s=>s.class.toLowerCase().includes(g.toLocaleLowerCase()),x=i==null?void 0:i.filter(I),m=h.useRef(null),b=()=>{if(m.current){const s=A.book_new(),c=m.current,p=A.table_to_sheet(c);A.book_append_sheet(s,p,"Sheet1");const u=ee(s,{bookType:"xlsx",type:"array"}),d=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=`Analisis_${v}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(d,t);else{const o=document.createElement("a");o.href=window.URL.createObjectURL(d),o.download=t,o.click()}}};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(f,{variant:"contained",color:"primary",onClick:()=>w(""),children:"All"}),j==null?void 0:j.map(s=>e.jsx(f,{variant:"contained",color:"primary",onClick:()=>w(s),children:s},s)),e.jsx(f,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:b,children:"Export"})]}),e.jsx(P,{sx:{overflow:"auto",width:{md:850,lg:1080,xl:1300}},children:e.jsx(F,{sx:{maxHeight:{md:480,xl:570}},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",ref:m,children:[e.jsxs($,{children:[e.jsxs(y,{children:[Se.map((s,c)=>e.jsx(r,{rowSpan:2,align:"center",sx:{minWidth:s.width},children:s.label},c)),l==null?void 0:l.filter(s=>s.type===1).map((s,c)=>e.jsx(r,{align:"center",sx:{minWidth:50},children:c+1},c)),e.jsx(r,{rowSpan:2,align:"center",children:"Benar"}),e.jsx(r,{rowSpan:2,align:"center",children:"Salah"}),e.jsx(r,{rowSpan:2,align:"center",children:"Nilai"})]}),e.jsx(y,{children:l==null?void 0:l.filter(s=>s.type===1).map((s,c)=>e.jsx(r,{align:"center",sx:{minWidth:50},children:s.key},c))})]}),e.jsx(M,{children:x==null?void 0:x.map((s,c)=>e.jsxs(h.Fragment,{children:[e.jsxs(y,{children:[e.jsx(r,{align:"center",rowSpan:2,children:c+1}),e.jsx(r,{align:"center",rowSpan:2,children:s.nis}),e.jsx(r,{rowSpan:2,children:s.name}),e.jsx(r,{align:"center",rowSpan:2,children:s.class}),l==null?void 0:l.filter(p=>p.type===1).map((p,u)=>{const d=s.answers.find(t=>t.questionId===p.id);return e.jsx(r,{align:"center",children:d?d.mc:"-"},u)}),e.jsx(r,{align:"center",rowSpan:2,children:s.correct}),e.jsx(r,{align:"center",rowSpan:2,children:s.wrong}),e.jsx(r,{align:"center",rowSpan:2,children:s.mcPoin})]}),e.jsx(y,{children:l==null?void 0:l.filter(p=>p.type===1).map((p,u)=>{const d=s.answers.find(t=>t.questionId===p.id);return e.jsx(r,{align:"center",children:d?d.poin:"-"},u)})})]},c))})]})})})]})},Y=i=>({__html:i}),ve=[{label:"No",width:30},{label:"NIS",width:80},{label:"Nama",width:200},{label:"Kelas",width:30},{label:"Nilai",width:30},{label:"Koreksi Jawaban",width:30}],Ie=({data:i,questions:l})=>{var B,J;const v=O(),g=v.quizId,w=v.gradeId,[j,{data:I,isSuccess:x,isLoading:m,error:b}]=ae(),[s,c]=h.useState(""),[p,u]=h.useState(""),[d,t]=h.useState(!1),[o,a]=h.useState({}),C=l==null?void 0:l.filter(n=>n.type===2),_=i==null?void 0:i.find(n=>n.nis===s),E=[...new Set(i==null?void 0:i.map(n=>n.class))],G=n=>n.class.toLowerCase().includes(p.toLocaleLowerCase()),T=i==null?void 0:i.filter(G),S=(J=(B=_==null?void 0:_.answers)==null?void 0:B.filter(n=>n.essay!==null))==null?void 0:J.map(n=>({nis:_.nis,questionId:n.questionId,essay:n.essay,poin:n.poin})),Q=n=>{c(n),t(!0)},H=(n,k)=>{a(L=>({...L,[n]:k}))},U=async n=>{n.preventDefault();const k=Object.entries(o).map(([L,D])=>({questionId:L,poin:parseInt(D)}));await Promise.all(k.map(({questionId:L,poin:D})=>{j({id:L,body:{poin:D,nis:_.nis,gradeId:w,quizId:g}})}))};return h.useEffect(()=>{x&&(R.success(I.message),t(!1),a({})),b&&R.error(b.data.message)},[I,x,b]),e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(f,{variant:"contained",color:"primary",onClick:()=>u(""),children:"All"}),E==null?void 0:E.map(n=>e.jsx(f,{variant:"contained",color:"primary",onClick:()=>u(n),children:n},n))]}),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:530,lg:550,xl:630}},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx($,{children:e.jsx(y,{children:ve.map((n,k)=>e.jsx(r,{align:"center",sx:{width:n.width},children:n.label},k))})}),e.jsx(M,{children:T==null?void 0:T.map((n,k)=>e.jsxs(y,{children:[e.jsx(r,{align:"center",children:k+1}),e.jsx(r,{align:"center",children:n.nis}),e.jsx(r,{children:n.name}),e.jsx(r,{align:"center",children:n.class}),e.jsx(r,{align:"center",children:n.essayPoin}),e.jsx(r,{align:"center",children:e.jsx(f,{variant:"contained",color:"info",onClick:()=>Q(n.nis),children:"koreksi"})})]},k))})]})})}),e.jsx(me,{open:d,onClose:()=>t(!1),closeAfterTransition:!0,children:e.jsx(ge,{in:d,children:e.jsx(Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:350,md:600},maxHeight:600,overflow:"auto",bgcolor:"#ffff",boxShadow:24,p:1,borderRadius:"5px"},children:e.jsxs("form",{onSubmit:U,children:[e.jsxs(z,{children:[e.jsx($,{children:e.jsx(y,{children:["Question","Answer","Score"].map(n=>e.jsx(r,{children:n},n))})}),e.jsx(M,{children:C==null?void 0:C.map(n=>{var k,L,D;return e.jsxs(y,{children:[e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:Y(n.question)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:Y((k=S==null?void 0:S.find(N=>N.questionId===n.id))==null?void 0:k.essay)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(se,{value:o[n.id]!==void 0?o[n.id]:((L=S==null?void 0:S.find(N=>N.questionId===n.id))==null?void 0:L.poin)!==void 0?(D=S==null?void 0:S.find(N=>N.questionId===n.id))==null?void 0:D.poin:0,onChange:N=>H(n.id,N.target.value)})})]},n.id)})})]}),e.jsx(f,{fullWidth:!0,variant:"contained",color:"success",type:"submit",children:m?e.jsx(K,{size:20,color:"inherit"}):"Submit"}),e.jsx(f,{fullWidth:!0,variant:"contained",color:"error",onClick:()=>t(!1),sx:{mt:1},children:"close"})]})})})})]})},Ce=[{label:"No",width:30},{label:"NIS",width:80},{label:"Nama",width:200},{label:"Kelas",width:30},{label:"Pg",width:30},{label:"Essay",width:30},{label:"Nilai",width:30}],Le=({data:i,quizname:l,questions:v})=>{const[g,w]=h.useState(""),j=[...new Set(i==null?void 0:i.map(s=>s.class))],I=s=>s.class.toLowerCase().includes(g.toLocaleLowerCase()),x=i==null?void 0:i.filter(I),m=h.useRef(null),b=()=>{if(m.current){const s=A.book_new(),c=m.current,p=A.table_to_sheet(c);A.book_append_sheet(s,p,"Sheet1");const u=ee(s,{bookType:"xlsx",type:"array"}),d=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=`Nilai_${l}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(d,t);else{const o=document.createElement("a");o.href=window.URL.createObjectURL(d),o.download=t,o.click()}}};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(f,{variant:"contained",color:"primary",onClick:()=>w(""),children:"All"}),j==null?void 0:j.map(s=>e.jsx(f,{variant:"contained",color:"primary",onClick:()=>w(s),children:s},s)),e.jsx(f,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:b,children:"Export"})]}),e.jsx(P,{sx:{overflow:"auto"},children:e.jsx(F,{sx:{maxHeight:{md:530,lg:550,xl:640}},children:e.jsxs(z,{stickyHeader:!0,"aria-label":"sticky table",ref:m,children:[e.jsx($,{children:e.jsx(y,{children:Ce.map((s,c)=>e.jsx(r,{align:"center",sx:{width:s.width},children:s.label},c))})}),e.jsx(M,{children:x==null?void 0:x.map((s,c)=>e.jsxs(y,{children:[e.jsx(r,{align:"center",children:c+1}),e.jsx(r,{align:"center",children:s.nis}),e.jsx(r,{children:s.name}),e.jsx(r,{align:"center",children:s.class}),e.jsx(r,{align:"center",children:s.mcPoin}),e.jsx(r,{align:"center",children:s.essayPoin}),e.jsx(r,{align:"center",children:s.totalPoin})]},c))})]})})})]})},Pe=()=>{const[i,l]=h.useState(!0),[v,g]=h.useState(!1),[w,j]=h.useState(!1),[I,x]=h.useState(!1),m=()=>{l(!0),x(!1),j(!1),g(!1)},b=()=>{l(!1),g(!0),x(!1),j(!1)},s=()=>{l(!1),g(!1),j(!0),x(!1)},c=()=>{l(!1),g(!1),j(!1),x(!0)},p=O(),u=p.quizname,d=p.quizId,t=p.gradeId,{data:o,refetch:a}=ie(d,{skip:!d}),{data:C,refetch:_}=te({quizId:d,gradeId:t},{skip:!d&&!t}),{data:E,refetch:G}=le(d,{skip:!d}),[T,S]=h.useState(""),Q=B=>B.name.toLowerCase().includes(T.toLowerCase()),H=C==null?void 0:C.filter(Q),U=()=>{a(),_(),G()};return e.jsxs(h.Fragment,{children:[e.jsxs(P,{sx:{p:1,display:"flex",gap:1,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx(se,{placeholder:"Search Student",sx:{width:360},value:T,onChange:B=>S(B.target.value)}),e.jsxs(Z,{sx:{display:"flex",gap:1},children:[e.jsx(f,{sx:{width:170},variant:"contained",color:"error",startIcon:e.jsx(xe,{}),onClick:U,children:"Prbarui Data"}),e.jsx(f,{startIcon:e.jsx(pe,{}),variant:"contained",color:"success",onClick:m,children:"Log"}),e.jsx(f,{startIcon:e.jsx(je,{}),variant:"contained",color:"success",onClick:b,children:"pg"}),e.jsx(f,{startIcon:e.jsx(fe,{}),variant:"contained",color:"success",onClick:s,children:"essay"}),e.jsx(f,{startIcon:e.jsx(ue,{}),variant:"contained",color:"success",onClick:c,children:"Nilai"})]})]}),i&&e.jsx(ye,{data:H,logs:E}),v&&e.jsx(ke,{data:H,questions:o,quizname:u}),w&&e.jsx(Ie,{data:H,questions:o}),I&&e.jsx(Le,{data:H,quizname:u,questions:o})]})},ls=()=>e.jsxs(oe,{children:[e.jsx(ce,{title:"quiz Name"}),e.jsx(we,{container:!0,sx:{minHeight:"85vh",display:"flex",flexDirection:"column",gap:1},children:e.jsx(Pe,{})})]});export{ls as default};
