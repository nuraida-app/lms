import{Q as O,ak as ne,r as o,B as M,j as e,C as Y,am as re,c as Z,a7 as le,an as te,ao as ae}from"./index-B4oIbNwU.js";import{P as ie}from"./PageName-CEARqxte.js";import{L as ce}from"./Layout-Ce3KKoj1.js";import{d as oe,a as de,b as q,c as he,e as xe,f as je,g as pe,h as fe}from"./CloudDownloadOutlined-ChsdWPKH.js";import{P as I}from"./Paper-WBrkj_xq.js";import{T as W}from"./TableContainer-KSHk1eic.js";import{a as E,b as A,c as w,T as r}from"./TableRow-2MDI8QSh.js";import{T as $}from"./TableBody-C-AJ6jTb.js";import{T as U}from"./Typography-DLQ9NUQX.js";import{T as K}from"./Tooltip-Dru0Qzb9.js";import{I as V}from"./IconButton-DKYpUzhK.js";import{u as B,w as ee}from"./xlsx-DT8pmw08.js";import{B as j}from"./Button-CGa4e0l9.js";import{M as ue,F as me}from"./Modal-yF_fLTpP.js";import{I as se}from"./Input-Dj5u-xDW.js";import{G as ge}from"./Grid-DRYlEhgI.js";import"./ChevronRight-CvyNzzqS.js";import"./createSvgIcon-BZOpo86E.js";import"./GlobalStyles-Ddd3Vltf.js";import"./listItemIconClasses-DYp5XrKx.js";import"./useTheme-C3ddHqAM.js";import"./ListItemText-snJx1fDo.js";import"./CalendarMonth-Cs-Lek6-.js";import"./Style-BHIr2vnK.js";import"./Popper-gua1FSa-.js";import"./Grow-BiPl52xs.js";import"./utils-CoNKf_2-.js";const we=[{label:"No",width:30},{label:"NIS",width:100},{label:"Name",width:150},{label:"Class",width:30},{label:"Join",width:110},{label:"IP",width:110},{label:"Browser",width:110},{label:"Status",width:100},{label:"Reset",width:100}],be=({data:a,logs:i})=>{const v=O(),[u,{data:m,isSuccess:p,isLoading:g,error:d}]=ne(),b=(l,s)=>{const t={nis:l,logId:s,quizId:v.quizId};u(t)};return o.useEffect(()=>{p&&M.success(m.message),d&&M.error(d.data.message)},[m,p,d]),e.jsx(I,{sx:{overflow:"auto"},children:e.jsx(W,{sx:{maxHeight:{md:530,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(A,{children:e.jsx(w,{children:we.map((l,s)=>e.jsx(r,{align:"center",sx:{width:l.width},children:l.label},s))})}),e.jsx($,{children:a==null?void 0:a.map((l,s)=>{const t=i==null?void 0:i.find(h=>h.nis===l.nis);return e.jsxs(w,{children:[e.jsx(r,{align:"center",children:s+1}),e.jsx(r,{align:"center",children:l.nis}),e.jsx(r,{children:l.name}),e.jsx(r,{align:"center",children:l.class}),e.jsx(r,{align:"center",children:t?new Date(t.log_in).toLocaleDateString("id-ID",{hour:"numeric",minute:"numeric"}):"-"}),e.jsx(r,{align:"center",children:t?t.ip:"-"}),e.jsx(r,{align:"center",children:t?t.browser:"-"}),e.jsx(r,{align:"center",children:t?t!=null&&t.isActive?e.jsx(U,{sx:{color:"green",fontWeight:"bold"},children:"Ongoing"}):e.jsx(U,{sx:{color:"red",fontWeight:"bold"},children:"Finished"}):e.jsx(U,{sx:{color:"orange",fontWeight:"bold"},children:"Unjoin"})}),e.jsxs(r,{align:"center",children:[e.jsx(K,{title:"Reset",children:e.jsx("span",{children:e.jsx(V,{color:"info",onClick:()=>b(l.nis,t==null?void 0:t.id),disabled:!t,children:g?e.jsx(Y,{size:20,color:"inherit"}):e.jsx(oe,{})})})}),e.jsx(K,{title:"Rejoin",children:e.jsx("span",{children:e.jsx(V,{color:"error",disabled:t?!t.isDone:!0,children:e.jsx(de,{})})})})]})]},s)})})]})})})},ye=[{label:"No",width:70},{label:"NIS",width:100},{label:"Nama",width:250},{label:"Kelas",width:50}],Se=({data:a,questions:i,quizname:v})=>{const[u,m]=o.useState(""),p=[...new Set(a==null?void 0:a.map(s=>s.class))],g=s=>s.class.toLowerCase().includes(u.toLocaleLowerCase()),d=a==null?void 0:a.filter(g),b=o.useRef(null),l=()=>{if(b.current){const s=B.book_new(),t=b.current,h=B.table_to_sheet(t);B.book_append_sheet(s,h,"Sheet1");const f=ee(s,{bookType:"xlsx",type:"array"}),c=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),x=`Analisis_${v}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(c,x);else{const C=document.createElement("a");C.href=window.URL.createObjectURL(c),C.download=x,C.click()}}};return e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(j,{variant:"contained",color:"primary",onClick:()=>m(""),children:"All"}),p==null?void 0:p.map(s=>e.jsx(j,{variant:"contained",color:"primary",onClick:()=>m(s),children:s},s)),e.jsx(j,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:l,children:"Export"})]}),e.jsx(I,{sx:{overflowX:"auto",overflowY:"auto",width:{md:900,lg:1220,xl:1400}},children:e.jsx(W,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",sx:{minWidth:650},ref:b,children:[e.jsxs(A,{children:[e.jsxs(w,{children:[ye.map((s,t)=>e.jsx(r,{rowSpan:2,align:"center",sx:{minWidth:s.width},children:s.label},t)),i==null?void 0:i.filter(s=>s.type===1).map((s,t)=>e.jsx(r,{align:"center",sx:{minWidth:50},children:t+1},t)),e.jsx(r,{rowSpan:2,align:"center",children:"Correct"}),e.jsx(r,{rowSpan:2,align:"center",children:"Wrong"}),e.jsx(r,{rowSpan:2,align:"center",children:"Score"})]}),e.jsx(w,{children:i==null?void 0:i.filter(s=>s.type===1).map((s,t)=>e.jsx(r,{align:"center",sx:{minWidth:50},children:s.key},t))})]}),e.jsx($,{children:d==null?void 0:d.map((s,t)=>e.jsxs(o.Fragment,{children:[e.jsxs(w,{children:[e.jsx(r,{align:"center",rowSpan:2,children:t+1}),e.jsx(r,{align:"center",rowSpan:2,children:s.nis}),e.jsx(r,{rowSpan:2,children:s.name}),e.jsx(r,{align:"center",rowSpan:2,children:s.class}),i==null?void 0:i.filter(h=>h.type===1).map((h,f)=>{const c=s.answers.find(x=>x.questionId===h.id);return e.jsx(r,{align:"center",children:c?c.mc:"-"},f)}),e.jsx(r,{align:"center",rowSpan:2,children:s.correct}),e.jsx(r,{align:"center",rowSpan:2,children:s.wrong}),e.jsx(r,{align:"center",rowSpan:2,children:s.mcPoin})]}),e.jsx(w,{children:i==null?void 0:i.filter(h=>h.type===1).map((h,f)=>{const c=s.answers.find(x=>x.questionId===h.id);return e.jsx(r,{align:"center",children:c?c.poin:"-"},f)})})]},t))})]})})})]})},X=a=>({__html:a}),ve=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"Score",width:30},{label:"Correction",width:30}],Ce=({data:a,questions:i})=>{var H,J;const v=O(),u=v.quizId,m=v.gradeId,[p,{data:g,isSuccess:d,isLoading:b,error:l}]=re(),[s,t]=o.useState(""),[h,f]=o.useState(""),[c,x]=o.useState(!1),[C,z]=o.useState({}),L=i==null?void 0:i.filter(n=>n.type===2),P=a==null?void 0:a.find(n=>n.nis===s),D=[...new Set(a==null?void 0:a.map(n=>n.class))],F=n=>n.class.toLowerCase().includes(h.toLocaleLowerCase()),_=a==null?void 0:a.filter(F),y=(J=(H=P==null?void 0:P.answers)==null?void 0:H.filter(n=>n.essay!==null))==null?void 0:J.map(n=>({nis:P.nis,questionId:n.questionId,essay:n.essay,poin:n.poin})),Q=n=>{t(n),x(!0)},N=(n,S)=>{z(k=>({...k,[n]:S}))},G=async n=>{n.preventDefault();const S=Object.entries(C).map(([k,R])=>({questionId:k,poin:parseInt(R)}));await Promise.all(S.map(({questionId:k,poin:R})=>{p({id:k,body:{poin:R,nis:P.nis,gradeId:m,quizId:u}})}))};return o.useEffect(()=>{d&&(M.success(g.message),x(!1),z({})),l&&M.error(l.data.message)},[g,d,l]),e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(j,{variant:"contained",color:"primary",onClick:()=>f(""),children:"All"}),D==null?void 0:D.map(n=>e.jsx(j,{variant:"contained",color:"primary",onClick:()=>f(n),children:n},n))]}),e.jsx(I,{sx:{overflow:"auto"},children:e.jsx(W,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(A,{children:e.jsx(w,{children:ve.map((n,S)=>e.jsx(r,{align:"center",sx:{width:n.width},children:n.label},S))})}),e.jsx($,{children:_==null?void 0:_.map((n,S)=>e.jsxs(w,{children:[e.jsx(r,{align:"center",children:S+1}),e.jsx(r,{align:"center",children:n.nis}),e.jsx(r,{children:n.name}),e.jsx(r,{align:"center",children:n.class}),e.jsx(r,{align:"center",children:n.essayPoin}),e.jsx(r,{align:"center",children:e.jsx(j,{variant:"contained",color:"info",onClick:()=>Q(n.nis),children:"score"})})]},S))})]})})}),e.jsx(ue,{open:c,onClose:()=>x(!1),closeAfterTransition:!0,children:e.jsx(me,{in:c,children:e.jsx(Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:350,md:800},maxHeight:600,overflow:"auto",bgcolor:"#ffff",boxShadow:24,p:1,borderRadius:"5px"},children:e.jsxs("form",{onSubmit:G,children:[e.jsxs(E,{children:[e.jsx(A,{children:e.jsx(w,{children:["Question","Answer","Score"].map(n=>e.jsx(r,{children:n},n))})}),e.jsx($,{children:L==null?void 0:L.map(n=>{var S,k,R;return e.jsxs(w,{children:[e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:X(n.question)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx("div",{dangerouslySetInnerHTML:X((S=y==null?void 0:y.find(T=>T.questionId===n.id))==null?void 0:S.essay)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(se,{value:C[n.id]!==void 0?C[n.id]:((k=y==null?void 0:y.find(T=>T.questionId===n.id))==null?void 0:k.poin)!==void 0?(R=y==null?void 0:y.find(T=>T.questionId===n.id))==null?void 0:R.poin:0,onChange:T=>N(n.id,T.target.value)})})]},n.id)})})]}),e.jsx(j,{fullWidth:!0,variant:"contained",color:"success",type:"submit",children:b?e.jsx(Y,{size:20,color:"inherit"}):"Submit"}),e.jsx(j,{fullWidth:!0,variant:"contained",color:"error",onClick:()=>x(!1),sx:{mt:1},children:"close"})]})})})})]})},ke=[{label:"No",width:30},{label:"NIS",width:80},{label:"Name",width:200},{label:"Class",width:30},{label:"MC",width:30},{label:"Essay",width:30},{label:"Score",width:30}],Ie=({data:a,quizname:i})=>{const[v,u]=o.useState(""),m=[...new Set(a==null?void 0:a.map(l=>l.class))],p=l=>l.class.toLowerCase().includes(v.toLocaleLowerCase()),g=a==null?void 0:a.filter(p),d=o.useRef(null),b=()=>{if(d.current){const l=B.book_new(),s=d.current,t=B.table_to_sheet(s);B.book_append_sheet(l,t,"Sheet1");const h=ee(l,{bookType:"xlsx",type:"array"}),f=new Blob([h],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=`Nilai_${i}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(f,c);else{const x=document.createElement("a");x.href=window.URL.createObjectURL(f),x.download=c,x.click()}}};return e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,justifyContent:"end"},children:[e.jsx(j,{variant:"contained",color:"primary",onClick:()=>u(""),children:"All"}),m==null?void 0:m.map(l=>e.jsx(j,{variant:"contained",color:"primary",onClick:()=>u(l),children:l},l)),e.jsx(j,{variant:"contained",color:"warning",startIcon:e.jsx(q,{}),onClick:b,children:"Export"})]}),e.jsx(I,{sx:{overflow:"auto"},children:e.jsx(W,{sx:{maxHeight:{md:480,xl:570},width:"100%"},children:e.jsxs(E,{stickyHeader:!0,"aria-label":"sticky table",ref:d,children:[e.jsx(A,{children:e.jsx(w,{children:ke.map((l,s)=>e.jsx(r,{align:"center",sx:{width:l.width},children:l.label},s))})}),e.jsx($,{children:g==null?void 0:g.map((l,s)=>e.jsxs(w,{children:[e.jsx(r,{align:"center",children:s+1}),e.jsx(r,{align:"center",children:l.nis}),e.jsx(r,{children:l.name}),e.jsx(r,{align:"center",children:l.class}),e.jsx(r,{align:"center",children:l.mcPoin}),e.jsx(r,{align:"center",children:l.essayPoin}),e.jsx(r,{align:"center",children:l.totalPoin})]},s))})]})})})]})},Le=()=>{const[a,i]=o.useState(!0),[v,u]=o.useState(!1),[m,p]=o.useState(!1),[g,d]=o.useState(!1),b=()=>{i(!0),d(!1),p(!1),u(!1)},l=()=>{i(!1),u(!0),d(!1),p(!1)},s=()=>{i(!1),u(!1),p(!0),d(!1)},t=()=>{i(!1),u(!1),p(!1),d(!0)},h=O(),f=h.quizname,c=h.quizId,x=h.gradeId,{data:C,refetch:z}=le(c,{skip:!c}),{data:L,refetch:P}=te({quizId:c,gradeId:x},{skip:!c&&!x}),{data:D,refetch:F}=ae(c,{skip:!c}),[_,y]=o.useState(""),Q=H=>H.name.toLowerCase().includes(_.toLowerCase()),N=L==null?void 0:L.filter(Q),G=()=>{z(),P(),F()};return e.jsxs(o.Fragment,{children:[e.jsxs(I,{sx:{p:1,display:"flex",gap:1,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx(se,{placeholder:"Search Student",sx:{width:360},value:_,onChange:H=>y(H.target.value)}),e.jsxs(Z,{sx:{display:"flex",gap:1},children:[e.jsx(j,{sx:{width:170},variant:"contained",color:"error",startIcon:e.jsx(he,{}),onClick:G,children:"update data"}),e.jsx(j,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(xe,{}),variant:"contained",color:"success",onClick:b,children:"Log"}),e.jsx(j,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(je,{}),variant:"contained",color:"success",onClick:l,children:"mc"}),e.jsx(j,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(pe,{}),variant:"contained",color:"success",onClick:s,children:"essay"}),e.jsx(j,{sx:{width:{xs:130,md:180,lg:155}},startIcon:e.jsx(fe,{}),variant:"contained",color:"success",onClick:t,children:"scores"})]})]}),a&&e.jsx(be,{data:N,logs:D}),v&&e.jsx(Se,{data:N,questions:C,quizname:f}),m&&e.jsx(Ce,{data:N,questions:C}),g&&e.jsx(Ie,{data:N,quizname:f})]})},ss=()=>e.jsxs(ce,{children:[e.jsx(ie,{title:"quiz Name"}),e.jsx(ge,{container:!0,sx:{minHeight:"85vh",display:"flex",flexDirection:"column",gap:1},children:e.jsx(Le,{})})]});export{ss as default};
